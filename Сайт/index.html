<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–µ–ª–µ–Ω—ã–π –û–∞–∑–∏—Å ‚Äî –õ–µ–≥–µ–Ω–¥–∞ –ê–∫–∞–¥–µ–º–∏–∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2e7d32; --bg: #050a05; --accent: #4caf50; --light-green: #98ff98; --card-bg: rgba(255,255,255,0.95); }
        * { box-sizing: border-box; outline: none; }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%; 
            font-family: 'Ubuntu', sans-serif; 
            background-color: #0a1a0a;
            overflow: hidden; 
        }

        /* –ì–õ–ê–í–ù–´–ô –§–û–ù */
        .main-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.7)), 
                              url('https://images.pexels.com/photos/1072179/pexels-photo-1072179.jpeg?auto=compress&cs=tinysrgb&w=1920');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .site-header { position: absolute; top: 0; width: 100%; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; z-index: 100; background: rgba(0,0,0,0.8); backdrop-filter: blur(15px); border-bottom: 2px solid var(--primary); }
        .site-title { font-family: 'Montserrat'; font-size: 1.8rem; color: var(--accent); }
        
        #authLayer { position: fixed; inset: 0; z-index: 2000; background: #000; display: flex; justify-content: center; align-items: center; }
        .auth-card { background: white; color: #333; padding: 40px; border-radius: 40px; width: 400px; text-align: center; border: 4px solid var(--primary); }
        .auth-input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: 2px solid #ddd; }

        .layer { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; padding-top: 80px; }
        .hidden { display: none !important; }

        /* –°–ê–î–û–í–ê–Ø –°–ï–¢–ö–ê */
        .garden-grid { display: grid; grid-template-columns: repeat(4, 160px); gap: 15px; }
        .garden-slot { width: 160px; height: 190px; background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); border-radius: 25px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
        .garden-slot:hover { background: rgba(255,255,255,0.2); transform: scale(1.02); }
        
        .plant-card { width: 100%; height: 100%; background: var(--card-bg); color: #333; border-radius: 22px; padding: 12px; display: flex; flex-direction: column; align-items: center; box-shadow: 0 8px 15px rgba(0,0,0,0.5); }
        .bar { width: 100%; height: 8px; background: #ddd; border-radius: 10px; margin: 4px 0; overflow: hidden; }
        .fill { height: 100%; transition: 0.5s; }

        /* –ö–ù–û–ü–ö–ò */
        .btn { padding: 12px 25px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; font-family: 'Ubuntu'; text-transform: uppercase; }
        .btn-green { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .btn-green:hover { transform: translateY(-3px); filter: brightness(1.1); }
        .btn-locked { background: #333 !important; color: #666 !important; cursor: not-allowed !important; opacity: 0.6; }

        /* –•–û–¢–ë–ê–† */
        .hotbar { position: absolute; bottom: 30px; display: flex; gap: 15px; background: rgba(0,0,0,0.85); padding: 15px; border-radius: 30px; border: 1px solid #444; }
        .tool { width: 60px; height: 60px; background: #222; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer; position: relative; overflow: hidden; }
        .tool.active { border: 2px solid var(--accent); box-shadow: 0 0 15px var(--accent); }
        .cd-overlay { position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background: rgba(0,0,0,0.7); pointer-events: none; }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s; }
        .overlay.active { opacity: 1; visibility: visible; }
        .modal { background: white; color: #333; width: 90%; max-width: 500px; padding: 30px; border-radius: 35px; text-align: center; max-height: 85vh; overflow-y: auto; }
        
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f4f9f4; margin: 8px 0; border-radius: 20px; cursor: pointer; border: 1px solid #eee; }
        .item-row.locked { background: #f0f0f0; cursor: not-allowed; color: #999; border: 1px dashed #ccc; }
        .theory-box { background: #e8f5e9; padding: 15px; border-radius: 15px; text-align: left; margin: 15px 0; border-left: 5px solid var(--primary); font-size: 0.95rem; }
        .quiz-opt { width: 100%; padding: 12px; margin: 6px 0; border: 2px solid #eee; border-radius: 12px; cursor: pointer; font-weight: bold; }

        /* –°–¢–ò–õ–ò–ó–ê–¶–ò–Ø –¢–ï–ö–°–¢–ê –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ */
        .home-title { 
            font-size: 4rem; 
            color: var(--light-green); 
            text-shadow: 0 0 20px rgba(152, 255, 152, 0.6), 2px 4px 10px rgba(0,0,0,0.8); 
            margin-bottom: 10px;
            font-family: 'Montserrat';
        }
        .home-desc { 
            font-size: 1.3rem; 
            color: var(--light-green); 
            text-align: center; 
            max-width: 600px; 
            text-shadow: 1px 1px 8px rgba(0,0,0,0.9);
            font-weight: bold;
            opacity: 0.9;
        }
    </style>
</head>
<body>

    <div class="main-bg"></div>

    <div id="authLayer">
        <div class="auth-card">
            <h1 style="color: var(--primary); margin: 0;">OASIS</h1>
            <p style="color: #666; margin-bottom: 20px;">–í—Ö–æ–¥ –≤ –û–∞–∑–∏—Å</p>
            <input type="text" id="nameInput" class="auth-input" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="password" id="passInput" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-green" style="width: 100%; padding: 15px;" onclick="handleAuth()">–ù–ê–ß–ê–¢–¨</button>
        </div>
    </div>

    <div id="gameUI" class="hidden">
        <header class="site-header">
            <div class="site-title">–ó–ï–õ–ï–ù–´–ô –û–ê–ó–ò–°</div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <span id="scoreDisplay" style="font-size:1.4rem; color:var(--accent); font-weight:bold;">üí∞ 0</span>
                <span id="userLabel" style="font-weight: bold;"></span>
                <button onclick="location.reload()" style="color:#ff5252; background:none; border:none; cursor:pointer; font-weight:bold;">–í–´–•–û–î</button>
            </div>
        </header>

        <nav style="position: absolute; top: 90px; display: flex; gap: 12px; z-index: 100">
            <button class="btn btn-green" onclick="showPage('mainPage')">–ê–∫–∞–¥–µ–º–∏—è</button>
            <button class="btn btn-green" onclick="showPage('gardenPage')">–ú–æ–π –°–∞–¥</button>
            <button class="btn" style="background: #ffd700; color: #333;" onclick="openLeaderboard()">üèÜ –¢–æ–ø</button>
        </nav>

        <div id="mainPage" class="layer">
            <h1 class="home-title">–ê–ö–ê–î–ï–ú–ò–Ø</h1>
            <p class="home-desc">
                –ò–∑—É—á–∞–π –ø—Ä–∏—Ä–æ–¥—É, —Å–¥–∞–≤–∞–π —ç–∫–∑–∞–º–µ–Ω—ã –∏ –æ—Ç–∫—Ä—ã–≤–∞–π –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ —Å–µ–º–µ–Ω–∞. <br> –ö–∞–∂–¥–æ–µ –∑–Ω–∞–Ω–∏–µ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç —Ç–µ–±—è –∫ –î–µ—Ä–µ–≤—É –ñ–∏–∑–Ω–∏!
            </p>
            <button class="btn btn-green" style="padding: 22px 70px; font-size: 1.3rem; margin-top: 25px;" onclick="openCatalog()">–ö–ê–¢–ê–õ–û–ì –ó–ù–ê–ù–ò–ô</button>
        </div>

        <div id="gardenPage" class="layer hidden">
            <div class="garden-grid" id="gardenGrid"></div>
            <div class="hotbar">
                <div class="tool active" id="t-water" onclick="setTool('water')">üíß <div id="cd-water" class="cd-overlay"></div></div>
                <div class="tool" id="t-food" onclick="setTool('food')">üß™ <div id="cd-food" class="cd-overlay"></div></div>
                <div class="tool" id="t-trash" onclick="setTool('trash')">üóëÔ∏è <div id="cd-trash" class="cd-overlay"></div></div>
            </div>
        </div>
    </div>

    <div class="overlay" id="modalOverlay"><div class="modal" id="modalContent"></div></div>

    <script>
        const plants = [
            { id: 0, name: '–ú–æ–Ω—Å—Ç–µ—Ä–∞', icon: 'üåø', price: 2, testCost: 0, info: '–¢—Ä–æ–ø–∏—á–µ—Å–∫–∞—è –ª–∏–∞–Ω–∞. –î—ã—Ä–∫–∏ –≤ –ª–∏—Å—Ç—å—è—Ö –ø–æ–º–æ–≥–∞—é—Ç –µ–π –≤—ã–∂–∏–≤–∞—Ç—å –≤–æ –≤—Ä–µ–º—è —Å–∏–ª—å–Ω—ã—Ö –ª–∏–≤–Ω–µ–π –∏ –≤–µ—Ç—Ä–æ–≤.', questions: [
                {q: '–ö –∫–∞–∫–æ–º—É —Ç–∏–ø—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –ú–æ–Ω—Å—Ç–µ—Ä–∞?', o: ['–î–µ—Ä–µ–≤–æ', '–õ–∏–∞–Ω–∞', '–¢—Ä–∞–≤–∞'], a: 1},
                {q: '–ó–∞—á–µ–º –µ–π –¥—ã—Ä–∫–∏ –≤ –ª–∏—Å—Ç—å—è—Ö?', o: ['–ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –≤–µ—Ç–µ—Ä', '–î–ª—è –∫—Ä–∞—Å–æ—Ç—ã', '–ß—Ç–æ–±—ã –±–æ–ª—å—à–µ –ø–∏—Ç—å'], a: 0},
                {q: '–ß—Ç–æ –æ–Ω–∞ –ª—é–±–∏—Ç?', o: ['–ü—Ä—è–º–æ–µ —Å–æ–ª–Ω—Ü–µ', '–¢–µ–Ω—å –∏ –≤–ª–∞–≥—É', '–•–æ–ª–æ–¥'], a: 1},
                {q: '–ö–∞–∫ –æ–Ω–∞ –ø–æ–ª–∑–µ—Ç –≤–≤–µ—Ä—Ö?', o: ['–®–∏–ø–∞–º–∏', '–í–æ–∑–¥—É—à–Ω—ã–º–∏ –∫–æ—Ä–Ω—è–º–∏', '–£—Å–∞–º–∏'], a: 1},
                {q: '–ú–æ–Ω—Å—Ç–µ—Ä–∞ —è–¥–æ–≤–∏—Ç–∞?', o: ['–î–∞ (—Å–æ–∫)', '–ù–µ—Ç', '–¢–æ–ª—å–∫–æ –ø–ª–æ–¥—ã'], a: 0}
            ]},
            { id: 1, name: '–ö–∞–∫—Ç—É—Å', icon: 'üåµ', price: 12, testCost: 150, info: '–†–∞—Å—Ç–µ–Ω–∏–µ –ø—É—Å—Ç—ã–Ω—å. –ò–≥–æ–ª–∫–∏ ‚Äî —ç—Ç–æ –≤–∏–¥–æ–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ª–∏—Å—Ç—å—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—á—Ç–∏ –Ω–µ –∏—Å–ø–∞—Ä—è—é—Ç –≤–ª–∞–≥—É.', questions: [
                {q: '–ß–µ–º —è–≤–ª—è—é—Ç—Å—è –∏–≥–æ–ª–∫–∏?', o: ['–õ–∏—Å—Ç—å—è–º–∏', '–í–µ—Ç–∫–∞–º–∏', '–ö–æ—Ä–Ω—è–º–∏'], a: 0},
                {q: '–ì–¥–µ –∫–∞–∫—Ç—É—Å —Ö—Ä–∞–Ω–∏—Ç –≤–æ–¥—É?', o: ['–í –∏–≥–æ–ª–∫–∞—Ö', '–í –º—è—Å–∏—Å—Ç–æ–º —Å—Ç–µ–±–ª–µ', '–í —Ü–≤–µ—Ç–∞—Ö'], a: 1},
                {q: '–ù—É–∂–µ–Ω –ª–∏ –µ–º—É —á–∞—Å—Ç—ã–π –ø–æ–ª–∏–≤?', o: ['–î–∞', '–ù–µ—Ç', '–ö–∞–∂–¥—ã–π —á–∞—Å'], a: 1},
                {q: '–ö–∞–∫—Ç—É—Å—ã —Ü–≤–µ—Ç—É—Ç?', o: ['–ù–∏–∫–æ–≥–¥–∞', '–î–∞', '–¢–æ–ª—å–∫–æ –≤ —Ç–µ–Ω–∏'], a: 1},
                {q: '–ì–¥–µ –µ–≥–æ —Ä–æ–¥–∏–Ω–∞?', o: ['–î–∂—É–Ω–≥–ª–∏', '–ü—É—Å—Ç—ã–Ω—è', '–¢–∞–π–≥–∞'], a: 1}
            ]},
            { id: 2, name: '–ú—É—Ö–æ–ª–æ–≤–∫–∞', icon: 'ü™¥', price: 40, testCost: 700, info: '–•–∏—â–Ω–∏–∫. –õ–æ–≤–∏—Ç –Ω–∞—Å–µ–∫–æ–º—ã—Ö, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∞–∑–æ—Ç –∏–∑ –∏—Ö —Ç–µ–ª, —Ç–∞–∫ –∫–∞–∫ –∂–∏–≤–µ—Ç –Ω–∞ –±–µ–¥–Ω—ã—Ö –ø–æ—á–≤–∞—Ö.', questions: [
                {q: '–ß—Ç–æ –µ—Å—Ç –ú—É—Ö–æ–ª–æ–≤–∫–∞?', o: ['–¢—Ä–∞–≤—É', '–ù–∞—Å–µ–∫–æ–º—ã—Ö', '–¢–æ–ª—å–∫–æ –≤–æ–¥—É'], a: 1},
                {q: '–ó–∞—á–µ–º –µ–π –∂–µ—Ä—Ç–≤—ã?', o: ['–†–∞–¥–∏ –∞–∑–æ—Ç–∞', '–î–ª—è —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', '–í–º–µ—Å—Ç–æ –≤–æ–¥—ã'], a: 0},
                {q: '–ì–¥–µ –æ–Ω–∞ –∂–∏–≤–µ—Ç?', o: ['–í –ø—É—Å—Ç—ã–Ω–µ', '–ù–∞ –±–æ–ª–æ—Ç–∞—Ö', '–í –ª–µ—Å—É'], a: 1},
                {q: '–ù–∞ —á—Ç–æ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –ª–æ–≤—É—à–∫–∞?', o: ['–ù–∞ —Å–≤–µ—Ç', '–ù–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ª–æ—Å–∫–∏', '–ù–∞ –∑–≤—É–∫'], a: 1},
                {q: '–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ª–∏—Å—Ç –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å—Å—è?', o: ['–í–µ—á–Ω–æ', '–ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (3-5)', '1 —Ä–∞–∑'], a: 1}
            ]},
            { id: 3, name: '–ë–∞–º–±—É–∫', icon: 'üéã', price: 120, testCost: 2500, info: '–°–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è —Ç—Ä–∞–≤–∞. –ú–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∞—Ç—å –ø–æ—á—Ç–∏ –Ω–∞ –º–µ—Ç—Ä –∑–∞ —Å—É—Ç–∫–∏. –í–Ω—É—Ç—Ä–∏ —Å—Ç–µ–±–µ–ª—å –ø—É—Å—Ç–æ–π.', questions: [
                {q: '–ë–∞–º–±—É–∫ —ç—Ç–æ...', o: ['–î–µ—Ä–µ–≤–æ', '–¢—Ä–∞–≤–∞', '–ö—É—Å—Ç–∞—Ä–Ω–∏–∫'], a: 1},
                {q: '–ö–∞–∫ –±—ã—Å—Ç—Ä–æ –æ–Ω —Ä–∞—Å—Ç–µ—Ç?', o: ['1 —Å–º –≤ –¥–µ–Ω—å', '–î–æ 90 —Å–º –≤ –¥–µ–Ω—å', '–ù–µ —Ä–∞—Å—Ç–µ—Ç'], a: 1},
                {q: '–°—Ç–µ–±–µ–ª—å –≤–Ω—É—Ç—Ä–∏...', o: ['–ü—É—Å—Ç–æ–π', '–ü–ª–æ—Ç–Ω—ã–π', '–° –ø–µ—Å–∫–æ–º'], a: 0},
                {q: '–ö—Ç–æ –ø–∏—Ç–∞–µ—Ç—Å—è –±–∞–º–±—É–∫–æ–º?', o: ['–ü–∞–Ω–¥–∞', '–¢–∏–≥—Ä', '–û—Ä–µ–ª'], a: 0},
                {q: '–û–Ω –ø—Ä–æ—á–Ω—ã–π?', o: ['–î–∞', '–ù–µ—Ç', '–ö–∞–∫ –ø–ª–∞—Å—Ç–∏–ª–∏–Ω'], a: 0}
            ]},
            { id: 4, name: '–î–µ—Ä–µ–≤–æ –ñ–∏–∑–Ω–∏', icon: 'üíé', price: 1200, testCost: 30000, info: '–ú–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ—Ä–µ–≤–æ. –ü–ª–æ–¥–æ–Ω–æ—Å–∏—Ç —á–∏—Å—Ç–æ–π –º–∞–Ω–æ–π –∏ –∑–æ–ª–æ—Ç–æ–º. –§–∏–Ω–∞–ª—å–Ω–∞—è —Ü–µ–ª—å –ª—é–±–æ–≥–æ —Å–∞–¥–æ–≤–æ–¥–∞.', questions: [
                {q: '–ß—Ç–æ –¥–∞–µ—Ç —ç—Ç–æ –¥–µ—Ä–µ–≤–æ?', o: ['–î—Ä–æ–≤–∞', '–ú–∞–Ω—É –∏ –±–æ–≥–∞—Ç—Å—Ç–≤–æ', '–¢–µ–Ω—å'], a: 1},
                {q: '–õ–µ–≥–∫–æ –ª–∏ –µ–≥–æ –ø–æ–ª—É—á–∏—Ç—å?', o: ['–î–∞', '–ù–µ—Ç, —ç—Ç–æ —Ñ–∏–Ω–∞–ª', '–û—á–µ–Ω—å –ª–µ–≥–∫–æ'], a: 1},
                {q: '–≠—Ç–æ –¥–µ—Ä–µ–≤–æ —Ä–µ–∞–ª—å–Ω–æ?', o: ['–í –Ω–∞—à–µ–π –∏–≥—Ä–µ - –¥–∞!', '–ù–µ—Ç', '–û–±—ã—á–Ω—ã–π –¥—É–±'], a: 0},
                {q: '–¢—ã –≥–æ—Ç–æ–≤ –ø–æ–±–µ–¥–∏—Ç—å?', o: ['–î–∞', '–ù–µ—Ç', '–ï—â—ë –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å'], a: 0},
                {q: '–ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —É—Å–ø–µ—Ö–∞?', o: ['–ó–Ω–∞–Ω–∏—è –∏ –º–æ–Ω–µ—Ç—ã', '–¢–æ–ª—å–∫–æ —É–¥–∞—á–∞', '–ù–∏—á–µ–≥–æ'], a: 0}
            ]}
        ];

        let currentUser = null;
        let gameData = { score: 0, unlocked: [0], garden: new Array(8).fill(null), examCD: {} };
        let currentTool = 'water';
        let testStep = 0, scoreInTest = 0;

        function handleAuth() {
            const name = document.getElementById('nameInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();
            if(!name || !pass) return alert("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ!");
            let users = JSON.parse(localStorage.getItem('oasis_v14_db') || '{}');
            if(users[name]) {
                if(users[name].pass !== pass) return alert("–ü–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π!");
                gameData = users[name].data;
            } else {
                users[name] = { pass, data: gameData };
                localStorage.setItem('oasis_v14_db', JSON.stringify(users));
            }
            currentUser = name;
            document.getElementById('userLabel').innerText = "@" + name;
            document.getElementById('authLayer').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            renderGarden();
        }

        function save() {
            if(!currentUser) return;
            let users = JSON.parse(localStorage.getItem('oasis_v14_db') || '{}');
            users[currentUser].data = gameData;
            localStorage.setItem('oasis_v14_db', JSON.stringify(users));
        }

        function showPage(p) {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('gardenPage').classList.add('hidden');
            document.getElementById(p).classList.remove('hidden');
        }

        function openCatalog() {
            let h = '<h2>–ê–∫–∞–¥–µ–º–∏—è: –ö—É—Ä—Å—ã</h2>';
            plants.forEach((p, i) => {
                const isU = gameData.unlocked.includes(i);
                const prevU = i === 0 || gameData.unlocked.includes(i-1);
                const wait = Math.ceil(((gameData.examCD[i] || 0) - Date.now()) / 1000);
                
                if(!prevU) {
                    h += `<div class="item-row locked"><span>üîí –£—Ä–æ–≤–µ–Ω—å ${i+1}: –°–Ω–∞—á–∞–ª–∞ —Å–¥–∞–π –ø—Ä–æ—à–ª—ã–π</span></div>`;
                } else {
                    h += `<div class="item-row" onclick="showPlantInfo(${i})">
                        <span>${p.icon} <b>${p.name}</b></span>
                        <span>${isU ? '‚úÖ –ò–∑—É—á–µ–Ω–æ' : (wait > 0 ? '‚è≥ '+wait+'—Å' : 'üí∞ '+p.testCost)}</span>
                    </div>`;
                }
            });
            document.getElementById('modalContent').innerHTML = h + `<button class="btn btn-green" style="margin-top:15px; width:100%" onclick="closeM()">–ó–∞–∫—Ä—ã—Ç—å</button>`;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function showPlantInfo(idx) {
            const p = plants[idx];
            if(gameData.unlocked.includes(idx)) {
                document.getElementById('modalContent').innerHTML = `<h3>${p.icon} ${p.name}</h3><div class="theory-box">${p.info}</div><button class="btn btn-green" onclick="openCatalog()">–ù–∞–∑–∞–¥</button>`;
                return;
            }
            const wait = Math.ceil(((gameData.examCD[idx] || 0) - Date.now()) / 1000);
            const canAfford = gameData.score >= p.testCost;
            
            let btn = (wait > 0) 
                ? `<button class="btn btn-locked">–ü–æ–≤—Ç–æ—Ä —á–µ—Ä–µ–∑ ${wait}—Å</button>` 
                : `<button class="btn ${canAfford ? 'btn-green' : 'btn-locked'}" onclick="payAndStart(${idx})">${canAfford ? '–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É üí∞'+p.testCost : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ üí∞'}</button>`;
            
            document.getElementById('modalContent').innerHTML = `
                <h2>–ö—É—Ä—Å: ${p.name}</h2>
                <div class="theory-box"><b>–¢–µ–æ—Ä–∏—è:</b><br>${p.info}</div>
                <p>–≠–∫–∑–∞–º–µ–Ω: 5 –≤–æ–ø—Ä–æ—Å–æ–≤. –ù—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å 80%.</p>
                ${btn}
                <button class="btn" style="width:100%; margin-top:10px" onclick="openCatalog()">–ù–∞–∑–∞–¥</button>
            `;
        }

        function payAndStart(idx) {
            if(gameData.score < plants[idx].testCost) return;
            gameData.score -= plants[idx].testCost;
            testStep = 0; scoreInTest = 0;
            save(); renderQuiz(idx);
        }

        function renderQuiz(idx) {
            const q = plants[idx].questions[testStep];
            let opts = q.o.map((txt, i) => `<div class="quiz-opt" onclick="ansQuiz(${idx}, ${i})">${txt}</div>`).join('');
            document.getElementById('modalContent').innerHTML = `<h3>–í–æ–ø—Ä–æ—Å ${testStep+1}/5</h3><p>${q.q}</p><div>${opts}</div>`;
        }

        function ansQuiz(idx, ans) {
            if(ans === plants[idx].questions[testStep].a) scoreInTest += 20;
            testStep++;
            if(testStep < 5) renderQuiz(idx);
            else {
                if(scoreInTest >= 80) {
                    gameData.unlocked.push(idx);
                    alert("–≠–∫–∑–∞–º–µ–Ω —Å–¥–∞–Ω! –ù–æ–≤–æ–µ —Ä–∞—Å—Ç–µ–Ω–∏–µ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.");
                } else {
                    gameData.examCD[idx] = Date.now() + 30000;
                    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–ª–æ–≤ ("+scoreInTest+"). –ñ–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–µ—Ä–µ—Å–¥–∞—á–∏.");
                }
                save(); openCatalog();
            }
        }

        function openLeaderboard() {
            let users = JSON.parse(localStorage.getItem('oasis_v14_db') || '{}');
            let sorted = Object.keys(users).map(k => ({n: k, s: users[k].data.score})).sort((a,b) => b.s - a.s);
            let h = '<h2>üèÜ –¢–æ–ø –°–∞–¥–æ–≤–æ–¥–æ–≤</h2>';
            sorted.slice(0, 10).forEach((u, i) => h += `<div class="item-row"><span>${i+1}. <b>${u.n}</b></span><b>üí∞ ${Math.floor(u.s)}</b></div>`);
            document.getElementById('modalContent').innerHTML = h + `<button class="btn btn-green" style="width:100%; margin-top:10px" onclick="closeM()">–ó–∞–∫—Ä—ã—Ç—å</button>`;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function setTool(t) {
            currentTool = t;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById('t-'+t).classList.add('active');
        }

        function handleSlot(i) {
            const now = Date.now();
            const cd = {water: 1500, food: 3000, trash: 500}[currentTool];
            if(now - (window.lastUsed?.[currentTool] || 0) < cd) return;

            if(!gameData.garden[i]) {
                let h = '<h3>–ü–æ—Å–∞–¥–∏—Ç—å:</h3>';
                plants.filter((_, idx) => gameData.unlocked.includes(idx)).forEach(p => {
                    h += `<div class="item-row" onclick="plantNow(${i}, ${p.id})">${p.icon} ${p.name} <small>+${p.price}/—Å</small></div>`;
                });
                document.getElementById('modalContent').innerHTML = h + `<button class="btn" style="width:100%" onclick="closeM()">–û—Ç–º–µ–Ω–∞</button>`;
                document.getElementById('modalOverlay').classList.add('active');
            } else {
                let p = gameData.garden[i];
                if(currentTool === 'water') p.w = Math.min(p.w + 35, 100);
                if(currentTool === 'food') p.h = Math.min(p.h + 25, 100);
                if(currentTool === 'trash') gameData.garden[i] = null;
                if(!window.lastUsed) window.lastUsed = {};
                window.lastUsed[currentTool] = now;
                startVisualCD(currentTool, cd);
                save(); renderGarden();
            }
        }

        function startVisualCD(tool, time) {
            const el = document.getElementById('cd-'+tool);
            el.style.height = '100%';
            let start = Date.now();
            let timer = setInterval(() => {
                let diff = Date.now() - start;
                let perc = 100 - (diff / time * 100);
                if(perc <= 0) { el.style.height = '0%'; clearInterval(timer); }
                else el.style.height = perc + '%';
            }, 50);
        }

        function plantNow(s, id) { gameData.garden[s] = {id, w: 90, h: 100}; closeM(); save(); renderGarden(); }

        function renderGarden() {
            const g = document.getElementById('gardenGrid');
            if(!g) return; g.innerHTML = '';
            gameData.garden.forEach((p, i) => {
                if(!p) g.innerHTML += `<div class="garden-slot" onclick="handleSlot(${i})">‚ûï</div>`;
                else {
                    const info = plants.find(x => x.id === p.id);
                    g.innerHTML += `<div class="garden-slot" onclick="handleSlot(${i})">
                        <div class="plant-card">
                            <span style="font-size:3.5rem;">${info.icon}</span>
                            <div class="bar"><div class="fill" style="width:${p.w}%; background:#2196f3"></div></div>
                            <div class="bar"><div class="fill" style="width:${p.h}%; background:#4caf50"></div></div>
                            <small style="font-weight:bold; color:#888">${info.name}</small>
                        </div>
                    </div>`;
                }
            });
        }

        function closeM() { document.getElementById('modalOverlay').classList.remove('active'); }

        setInterval(() => {
            if(!currentUser) return;
            let pps = 0;
            gameData.garden.forEach(p => {
                if(p) {
                    p.w = Math.max(p.w - 0.9, 0); 
                    if(p.w < 20) p.h = Math.max(p.h - 1.5, 0); 
                    if(p.h > 40) pps += plants.find(x => x.id === p.id).price;
                }
            });
            gameData.score += pps;
            document.getElementById('scoreDisplay').innerText = `üí∞ ${Math.floor(gameData.score)}`;
            renderGarden();
            save();
        }, 1000);
    </script>
</body>
</html>