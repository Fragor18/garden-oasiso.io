<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OASIS ‚Äî Auth & Flora</title>
    <style>
        :root { --p: #2e7d32; --bg: #0a1a0a; --sky-day: #4facfe; --sky-night: #0a0f1e; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: sans-serif; background: #000; color: white; height: 100vh; overflow: hidden; }

        #sky { position: fixed; inset: 0; z-index: -1; transition: 3s; background: var(--sky-day); }

        /* –≠–ö–†–ê–ù –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò */
        #authScreen { position: fixed; inset: 0; z-index: 5000; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: white; color: #333; padding: 25px; border-radius: 20px; width: 100%; max-width: 320px; text-align: center; box-shadow: 0 0 20px var(--p); }
        .auth-card input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; }
        
        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        .header { background: rgba(0,0,0,0.8); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--p); z-index: 10; position: relative; }
        .score { font-size: 1.1rem; font-weight: bold; color: #4caf50; }

        .main-container { height: calc(100vh - 130px); overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; align-content: start; z-index: 5; position: relative; }
        @media (min-width: 600px) { .main-container { grid-template-columns: repeat(4, 1fr); } }

        .slot { aspect-ratio: 1/1.2; background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .slot.locked { background: rgba(0,0,0,0.5); color: #444; }
        
        .plant { background: white; color: #333; width: 92%; height: 92%; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 5px; }
        .bar { width: 80%; height: 5px; background: #eee; border-radius: 3px; overflow: hidden; margin: 1px 0; }
        .fill { height: 100%; transition: 0.3s; }

        /* –û–ö–ù–ê */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .m-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 400px; margin-top: 15px; }
        .m-item { background: white; color: #333; padding: 10px; border-radius: 10px; text-align: center; border: none; font-weight: bold; }
        .m-item.empty { background: #222; color: #444; border: 1px dashed #444; }

        .toolbar { position: fixed; bottom: 0; width: 100%; background: #111; padding: 10px; display: flex; justify-content: center; gap: 15px; border-top: 2px solid var(--p); z-index: 10; }
        .tool { font-size: 1.5rem; padding: 10px; background: #222; border-radius: 10px; cursor: pointer; opacity: 0.3; }
        .tool.active { opacity: 1; border: 2px solid #4caf50; }

        .btn { background: var(--p); color: white; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-buy { background: var(--p); color: white; border: none; padding: 6px; width: 100%; border-radius: 5px; margin-top: 5px; font-size: 11px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="sky"></div>

    <div id="authScreen">
        <div class="auth-card">
            <h2 style="margin-top:0; color:var(--p)">OASIS 2026</h2>
            <input type="text" id="userLogin" placeholder="–õ–æ–≥–∏–Ω">
            <input type="password" id="userPass" placeholder="–ü–∞—Ä–æ–ª—å">
            <div style="display:flex; gap:10px; margin-top:10px">
                <button class="btn" style="flex:1" onclick="handleAuth(true)">–í–û–ô–¢–ò</button>
                <button class="btn" style="flex:1; background:#444" onclick="handleAuth(false)">–†–ï–ì</button>
            </div>
            <p id="authMsg" style="font-size:12px; color:red; margin-top:10px"></p>
        </div>
    </div>

    <div id="gameUI" class="hidden">
        <div class="header">
            <div class="score" id="score">üí∞ 150</div>
            <div id="status">‚òÄÔ∏è ‚òÅÔ∏è</div>
            <button class="btn" onclick="toggleOverlay('marketOverlay', true)">üõí –†–´–ù–û–ö</button>
        </div>

        <div class="main-container" id="garden"></div>

        <div class="toolbar">
            <div class="tool active" id="t-water" onclick="setTool('water')">üíß</div>
            <div class="tool" id="t-food" onclick="setTool('food')">üß™</div>
            <div class="tool" id="t-trash" onclick="setTool('trash')">üóëÔ∏è</div>
            <button onclick="logout()" style="background:none; border:none; color:#555; font-size:10px">–í–´–•–û–î</button>
        </div>
    </div>

    <div class="overlay" id="marketOverlay">
        <h2>–ú–ê–ì–ê–ó–ò–ù –°–ï–ú–Ø–ù</h2>
        <p id="mTimer" style="font-size: 12px; color: #888;">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 05:00</p>
        <div class="m-grid" id="marketGrid"></div>
        <button class="btn" style="margin-top: 20px; background: #7d2e2e;" onclick="toggleOverlay('marketOverlay', false)">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div class="overlay" id="plantOverlay">
        <h2>–ú–û–Ø –°–£–ú–ö–ê</h2>
        <div class="m-grid" id="inventoryGrid"></div>
        <button class="btn" style="margin-top: 20px; background: #7d2e2e;" onclick="toggleOverlay('plantOverlay', false)">–û–¢–ú–ï–ù–ê</button>
    </div>

    <script>
        const FLORA = [
            { id: 0, n: '–¢—Ä–∞–≤–∞', i: 'üå±', inc: 1, c: 20, r: 0.9 },
            { id: 1, n: '–†–æ–º–∞—à–∫–∞', i: 'üåº', inc: 4, c: 100, r: 0.8 },
            { id: 2, n: '–ö–∞–∫—Ç—É—Å', i: 'üåµ', inc: 15, c: 400, r: 0.7 },
            { id: 3, n: '–¢—é–ª—å–ø–∞–Ω', i: 'üå∑', inc: 40, c: 1200, r: 0.6 },
            { id: 4, n: '–ü–æ–¥—Å–æ–ª–Ω—É—Ö', i: 'üåª', inc: 100, c: 5000, r: 0.5 },
            { id: 5, n: '–†–æ–∑–∞', i: 'üåπ', inc: 250, c: 15000, r: 0.4 },
            { id: 6, n: '–õ–∏–ª–∏—è', i: 'ü™∑', inc: 600, c: 40000, r: 0.3 },
            { id: 7, n: '–ü–∞–ª—å–º–∞', i: 'üå¥', inc: 1500, c: 100000, r: 0.25 },
            { id: 8, n: '–ë–∞–º–±—É–∫', i: 'üéã', inc: 4000, c: 300000, r: 0.2 },
            { id: 9, n: '–ï–ª—å', i: 'üå≤', inc: 10000, c: 1000000, r: 0.15 },
            { id: 10, n: '–ö–ª–µ–Ω', i: 'üçÅ', inc: 25000, c: 3000000, r: 0.1 },
            { id: 11, n: '–ú—É—Ö–æ–ª–æ–≤–∫–∞', i: 'ü™¥', inc: 60000, c: 8000000, r: 0.08 },
            { id: 12, n: '–ì—Ä–∏–±', i: 'üçÑ', inc: 150000, c: 25000000, r: 0.06 },
            { id: 13, n: '–í–∏—à–Ω—è', i: 'üçí', inc: 400000, c: 70000000, r: 0.05 },
            { id: 14, n: '–û—Ä–µ—Ö', i: 'üå∞', inc: 1000000, c: 180000000, r: 0.04 },
            { id: 15, n: '–õ–æ—Ç–æ—Å', i: 'ü™∑', inc: 2500000, c: 500000000, r: 0.03 },
            { id: 16, n: '–ê–Ω–∞–Ω–∞—Å', i: 'üçç', inc: 6000000, c: 1200000000, r: 0.02 },
            { id: 17, n: '–ú–∞–Ω–≥–æ', i: 'ü•≠', inc: 15000000, c: 4000000000, r: 0.01 },
            { id: 18, n: '–ê—Ä–±—É–∑', i: 'üçâ', inc: 40000000, c: 10000000000, r: 0.008 },
            { id: 19, n: '–ö–ª–µ–≤–µ—Ä', i: 'üçÄ', inc: 100000000, c: 30000000000, r: 0.005 },
            { id: 20, n: '–î—Ä–∞–∫–æ–Ω', i: 'üêâ', inc: 500000000, c: 99000000000, r: 0.002 }
        ];

        let currentUser = null;
        let gameData = { score: 150, slots: 3, garden: new Array(16).fill(null), inventory: [0, 0] };
        let marketItems = [];
        let marketTimer = 300;
        let currentTool = 'water';
        let activeSlotIdx = null;

        // –õ–û–ì–ò–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        function handleAuth(isLogin) {
            const login = document.getElementById('userLogin').value.trim().toLowerCase();
            const pass = document.getElementById('userPass').value.trim();
            const msg = document.getElementById('authMsg');
            if(!login || !pass) return msg.innerText = "–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!";

            let users = JSON.parse(localStorage.getItem('oasis_users') || '{}');

            if(isLogin) {
                if(users[login] && users[login].pass === pass) {
                    currentUser = login;
                    gameData = users[login].data;
                    startGame();
                } else {
                    msg.innerText = "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!";
                }
            } else {
                if(users[login]) {
                    msg.innerText = "–õ–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç!";
                } else {
                    users[login] = { pass: pass, data: { score: 150, slots: 3, garden: new Array(16).fill(null), inventory: [0] } };
                    localStorage.setItem('oasis_users', JSON.stringify(users));
                    msg.style.color = "green";
                    msg.innerText = "–£—Å–ø–µ—à–Ω–æ! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏.";
                }
            }
        }

        function saveProgress() {
            if(!currentUser) return;
            let users = JSON.parse(localStorage.getItem('oasis_users') || '{}');
            users[currentUser].data = gameData;
            localStorage.setItem('oasis_users', JSON.stringify(users));
        }

        function startGame() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            refreshMarket();
            renderGarden();
        }

        function logout() { location.reload(); }

        // –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê
        function renderGarden() {
            const g = document.getElementById('garden');
            g.innerHTML = '';
            for(let i=0; i<16; i++) {
                let p = gameData.garden[i];
                let locked = i >= gameData.slots;
                let div = document.createElement('div');
                div.className = 'slot' + (locked ? ' locked' : '');

                if(locked) {
                    let cost = gameData.slots * 2500;
                    div.innerHTML = `üîí<br><small>${cost}</small>`;
                    div.onclick = () => { if(gameData.score >= cost) { gameData.score -= cost; gameData.slots++; renderGarden(); saveProgress(); } };
                } else if(!p) {
                    div.innerHTML = '‚ûï';
                    div.onclick = () => { activeSlotIdx = i; openPlantMenu(); };
                } else {
                    let info = FLORA[p.id];
                    div.innerHTML = `
                        <div class="plant">
                            <span style="font-size:9px;color:#888">${Math.floor(p.age)}/50</span>
                            <div style="font-size:2.3rem">${info.i}</div>
                            <div class="bar"><div class="fill" style="width:${p.w}%; background:#3b82f6"></div></div>
                            <div class="bar"><div class="fill" style="width:${p.h}%; background:#22c55e"></div></div>
                        </div>`;
                    div.onclick = () => {
                        if(currentTool === 'water') p.w = Math.min(p.w + 40, 100);
                        if(currentTool === 'food') p.h = Math.min(p.h + 25, 100);
                        if(currentTool === 'trash') gameData.garden[i] = null;
                        renderGarden();
                        saveProgress();
                    };
                }
                g.appendChild(div);
            }
        }

        function openPlantMenu() {
            const grid = document.getElementById('inventoryGrid');
            if(gameData.inventory.length === 0) return alert("–ö—É–ø–∏ —Å–µ–º–µ–Ω–∞ –Ω–∞ —Ä—ã–Ω–∫–µ!");
            grid.innerHTML = gameData.inventory.map((id, idx) => {
                let p = FLORA[id];
                return `<button class="m-item" onclick="confirmPlant(${idx})">${p.i} ${p.n}</button>`;
            }).join('');
            toggleOverlay('plantOverlay', true);
        }

        function confirmPlant(invIdx) {
            let id = gameData.inventory.splice(invIdx, 1)[0];
            gameData.garden[activeSlotIdx] = { id, w: 100, h: 100, age: 0 };
            toggleOverlay('plantOverlay', false);
            renderGarden();
            saveProgress();
        }

        function refreshMarket() {
            marketItems = [];
            for(let i=0; i<6; i++) {
                let p = FLORA[Math.floor(Math.random() * FLORA.length)];
                marketItems.push(Math.random() < p.r ? p : null);
            }
            renderMarketUI();
        }

        function renderMarketUI() {
            const grid = document.getElementById('marketGrid');
            grid.innerHTML = marketItems.map((p, idx) => {
                if(!p) return `<div class="m-item empty">–ü–£–°–¢–û</div>`;
                return `<div class="m-item">
                    <div style="font-size:1.5rem">${p.i}</div>
                    <div style="font-size:10px">${p.n}</div>
                    <button class="btn-buy" onclick="buySeed(${idx})">üí∞ ${p.c}</button>
                </div>`;
            }).join('');
        }

        function buySeed(idx) {
            let p = marketItems[idx];
            if(gameData.score >= p.c) {
                gameData.score -= p.c;
                gameData.inventory.push(p.id);
                marketItems[idx] = null;
                renderMarketUI();
                saveProgress();
            }
        }

        function toggleOverlay(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
        function setTool(t) {
            currentTool = t;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById('t-'+t).classList.add('active');
        }

        setInterval(() => {
            if(!currentUser) return;
            marketTimer--;
            if(marketTimer <= 0) { marketTimer = 300; refreshMarket(); }
            
            let m = Math.floor(marketTimer / 60), s = marketTimer % 60;
            document.getElementById('mTimer').innerText = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${m}:${s<10?'0'+s:s}`;

            let sec = new Date().getSeconds();
            document.getElementById('sky').style.background = sec < 30 ? 'var(--sky-day)' : 'var(--sky-night)';
            document.getElementById('status').innerText = sec < 30 ? '‚òÄÔ∏è ‚òÅÔ∏è' : 'üåô ‚ú®';

            gameData.garden.forEach((p, i) => {
                if(p) {
                    p.w = Math.max(0, p.w - 0.7);
                    p.age += 0.1;
                    if(p.w < 20) p.h -= 0.6;
                    if(p.age >= 50 || p.h <= 0) gameData.garden[i] = null;
                    else if(p.h > 40) gameData.score += FLORA[p.id].inc;
                }
            });

            document.getElementById('score').innerText = 'üí∞ ' + Math.floor(gameData.score);
            saveProgress();
        }, 1000);
    </script>
</body>
</html>

