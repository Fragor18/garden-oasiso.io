<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OASIS 2026 ‚Äî Welcome</title>
    <style>
        :root { 
            --p: #2e7d32; --bg: #000; 
            --sky-day: #4facfe; --sky-night: #0a0f1e;
            --r0: #2ecc71; --r1: #3498db; --r2: #9b59b6; --r3: #f1c40f; --r4: #e74c3c;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; height: 100vh; overflow: hidden; }
        #sky { position: fixed; inset: 0; z-index: -1; transition: 3s; background: var(--sky-day); }

        /* –≠–ö–†–ê–ù –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø / –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø */
        .full-screen { position: fixed; inset: 0; z-index: 5000; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .welcome-title { font-size: 3rem; margin-bottom: 10px; color: var(--p); text-shadow: 0 0 15px var(--p); }
        .auth-card { background: white; color: #333; padding: 30px; border-radius: 25px; width: 100%; max-width: 350px; }
        .auth-card input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid #ddd; font-size: 16px; outline: none; }
        
        /* –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° */
        .header { background: rgba(0,0,0,0.85); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--p); z-index: 10; position: relative; }
        .score { font-size: 1.2rem; font-weight: bold; color: #4caf50; }

        .main-container { height: calc(100vh - 140px); overflow-y: auto; padding: 8px; display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; align-content: start; z-index: 5; position: relative; }
        
        /* –ì–†–Ø–î–ö–ê 5x5 */
        .slot { aspect-ratio: 1/1.2; background: rgba(255,255,255,0.1); border: 1px dashed rgba(255,255,255,0.2); border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; font-size: 11px; }
        .slot.locked { background: rgba(0,0,0,0.7); color: #444; }
        
        .plant { background: white; color: #333; width: 95%; height: 95%; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 4px; border-top: 4px solid #ccc; position: relative; }
        
        .rarity-0 { border-color: var(--r0) !important; }
        .rarity-1 { border-color: var(--r1) !important; }
        .rarity-2 { border-color: var(--r2) !important; }
        .rarity-3 { border-color: var(--r3) !important; }
        .rarity-4 { border-color: var(--r4) !important; animation: glow 1s infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 2px var(--r4); } to { box-shadow: 0 0 10px var(--r4); } }

        .bar { width: 90%; height: 4px; background: #eee; border-radius: 2px; overflow: hidden; }
        .fill { height: 100%; transition: 0.3s; }

        /* –£–õ–£–ß–®–ï–ù–ù–´–ô –ú–ê–ì–ê–ó–ò–ù */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 6000; display: none; flex-direction: column; align-items: center; padding: 25px; overflow-y: auto; }
        .m-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 450px; margin-top: 20px; }
        .m-item { background: white; color: #333; padding: 15px; border-radius: 18px; text-align: center; border: none; font-weight: bold; border-top: 6px solid #ccc; }
        .m-item .icon { font-size: 2.5rem; margin-bottom: 5px; display: block; }

        .toolbar { position: fixed; bottom: 0; width: 100%; background: #111; padding: 12px; display: flex; justify-content: center; gap: 20px; border-top: 2px solid var(--p); z-index: 10; }
        .tool { font-size: 1.6rem; padding: 10px; background: #222; border-radius: 12px; cursor: pointer; opacity: 0.3; transition: 0.2s; }
        .tool.active { opacity: 1; border: 2px solid #4caf50; transform: scale(1.1); }

        .btn { background: var(--p); color: white; border: none; padding: 12px 20px; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-buy { background: var(--p); color: white; border: none; padding: 10px; width: 100%; border-radius: 10px; margin-top: 10px; font-size: 14px; font-weight: bold; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="sky"></div>

    <div id="welcomeScreen" class="full-screen">
        <h1 class="welcome-title">OASIS</h1>
        <p style="color: #aaa; margin-bottom: 30px;">–¢–≤–æ–π —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–∞–¥ –±—É–¥—É—â–µ–≥–æ</p>
        <div class="auth-card">
            <input type="text" id="userLogin" placeholder="–ò–º—è —Å–∞–¥–æ–≤–æ–¥–∞">
            <input type="password" id="userPass" placeholder="–ü–∞—Ä–æ–ª—å">
            <div style="display:flex; gap:10px; margin-top:10px">
                <button class="btn" style="flex:1" onclick="handleAuth(true)">–í–û–ô–¢–ò</button>
                <button class="btn" style="flex:1; background:#555" onclick="handleAuth(false)">–°–û–ó–î–ê–¢–¨</button>
            </div>
            <p id="authMsg" style="font-size:13px; color:red; margin-top:15px; min-height: 20px;"></p>
        </div>
    </div>

    <div id="gameUI" class="hidden">
        <div class="header">
            <div class="score" id="score">üí∞ 150</div>
            <div id="status">‚òÄÔ∏è ‚òÅÔ∏è</div>
            <button class="btn" style="padding: 8px 15px;" onclick="toggleOverlay('marketOverlay', true)">üõí –†–´–ù–û–ö</button>
        </div>
        <div class="main-container" id="garden"></div>
        <div class="toolbar">
            <div class="tool active" id="t-water" onclick="setTool('water')">üíß</div>
            <div class="tool" id="t-food" onclick="setTool('food')">üß™</div>
            <div class="tool" id="t-trash" onclick="setTool('trash')">üóëÔ∏è</div>
            <button onclick="location.reload()" style="background:none; border:none; color:#444; font-size:10px;">–í–´–ô–¢–ò</button>
        </div>
    </div>

    <div class="overlay" id="marketOverlay">
        <h2 style="margin:0">–ú–ê–ì–ê–ó–ò–ù –°–ï–ú–Ø–ù</h2>
        <p id="mTimer" style="font-size: 14px; color: #888; margin-bottom: 10px;">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 05:00</p>
        <div class="m-grid" id="marketGrid"></div>
        <button class="btn" style="margin-top: 30px; background: #7d2e2e; width: 200px;" onclick="toggleOverlay('marketOverlay', false)">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div class="overlay" id="plantOverlay">
        <h2>–ú–û–ò –°–ï–ú–ï–ù–ê</h2>
        <div class="m-grid" id="inventoryGrid"></div>
        <button class="btn" style="margin-top: 30px; background: #7d2e2e; width: 200px;" onclick="toggleOverlay('plantOverlay', false)">–û–¢–ú–ï–ù–ê</button>
    </div>

    <script>
        const FLORA = [
            { id: 0, n: '–¢—Ä–∞–≤–∞', i: 'üå±', inc: 1, c: 20, r: 1.0, rar: 0 },
            { id: 1, n: '–†–æ–º–∞—à–∫–∞', i: 'üåº', inc: 4, c: 120, r: 0.8, rar: 0 },
            { id: 2, n: '–ú—è—Ç–∞', i: 'üåø', inc: 10, c: 350, r: 0.8, rar: 0 },
            { id: 3, n: '–ö–∞–∫—Ç—É—Å', i: 'üåµ', inc: 30, c: 1500, r: 0.6, rar: 1 },
            { id: 4, n: '–¢—é–ª—å–ø–∞–Ω', i: 'üå∑', inc: 65, c: 4000, r: 0.6, rar: 1 },
            { id: 5, n: '–ü–æ–¥—Å–æ–ª–Ω—É—Ö', i: 'üåª', inc: 200, c: 18000, r: 0.5, rar: 1 },
            { id: 6, n: '–†–æ–∑–∞', i: 'üåπ', inc: 500, c: 50000, r: 0.4, rar: 2 },
            { id: 7, n: '–õ–∞–≤–∞–Ω–¥–∞', i: '‚öõÔ∏è', inc: 900, c: 100000, r: 0.4, rar: 2 },
            { id: 8, n: '–õ–∏–ª–∏—è', i: 'ü™∑', inc: 1600, c: 200000, r: 0.3, rar: 2 },
            { id: 9, n: '–ü–∞–ª—å–º–∞', i: 'üå¥', inc: 4000, c: 500000, r: 0.3, rar: 2 },
            { id: 10, n: '–ë–∞–º–±—É–∫', i: 'üéã', inc: 10000, c: 1500000, r: 0.2, rar: 3 },
            { id: 11, n: '–ï–ª—å', i: 'üå≤', inc: 25000, c: 4000000, r: 0.2, rar: 3 },
            { id: 12, n: '–ú—É—Ö–æ–ª–æ–≤–∫–∞', i: 'ü™¥', inc: 60000, c: 10000000, r: 0.15, rar: 3 },
            { id: 13, n: '–ì—Ä–∏–±', i: 'üçÑ', inc: 150000, c: 25000000, r: 0.1, rar: 3 },
            { id: 14, n: '–í–∏—à–Ω—è', i: 'üçí', inc: 400000, c: 80000000, r: 0.08, rar: 4 },
            { id: 15, n: '–û—Ä–µ—Ö', i: 'üå∞', inc: 1000000, c: 250000000, r: 0.06, rar: 4 },
            { id: 16, n: '–õ–æ—Ç–æ—Å', i: 'üíÆ', inc: 2500000, c: 800000000, r: 0.04, rar: 4 },
            { id: 17, n: '–ê—Ä–±—É–∑', i: 'üçâ', inc: 8000000, c: 3000000000, r: 0.03, rar: 4 },
            { id: 18, n: '–î—Ä–∞–∫–æ–Ω', i: 'üêâ', inc: 25000000, c: 12000000000, r: 0.02, rar: 4 },
            { id: 19, n: '–ó–≤–µ–∑–¥–∞', i: '‚ú®', inc: 80000000, c: 40000000000, r: 0.01, rar: 4 }
        ];

        let currentUser = null;
        let gameData = { score: 150, slots: 5, garden: new Array(25).fill(null), inventory: [0] };
        let marketItems = [];
        let marketTimer = 300;
        let currentTool = 'water';
        let activeSlotIdx = null;

        function handleAuth(isLogin) {
            const login = document.getElementById('userLogin').value.trim().toLowerCase();
            const pass = document.getElementById('userPass').value.trim();
            const msg = document.getElementById('authMsg');
            if(!login || !pass) return msg.innerText = "–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!";
            let users = JSON.parse(localStorage.getItem('oasis_users_v2') || '{}');
            if(isLogin) {
                if(users[login] && users[login].pass === pass) { currentUser = login; gameData = users[login].data; startGame(); }
                else { msg.innerText = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞!"; }
            } else {
                if(users[login]) { msg.innerText = "–õ–æ–≥–∏–Ω –∑–∞–Ω—è—Ç!"; }
                else { users[login] = { pass, data: { score: 150, slots: 5, garden: new Array(25).fill(null), inventory: [0] } }; localStorage.setItem('oasis_users_v2', JSON.stringify(users)); msg.style.color = "green"; msg.innerText = "–ê–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞–Ω! –í–æ–π–¥–∏—Ç–µ."; }
            }
        }

        function save() {
            if(!currentUser) return;
            let users = JSON.parse(localStorage.getItem('oasis_users_v2') || '{}');
            users[currentUser].data = gameData;
            localStorage.setItem('oasis_users_v2', JSON.stringify(users));
        }

        function startGame() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            refreshMarket();
            renderGarden();
        }

        function renderGarden() {
            const g = document.getElementById('garden');
            g.innerHTML = '';
            for(let i=0; i<25; i++) {
                let p = gameData.garden[i];
                let locked = i >= gameData.slots;
                let div = document.createElement('div');
                div.className = 'slot' + (locked ? ' locked' : '');
                if(locked) {
                    let cost = gameData.slots * 5000;
                    div.innerHTML = `üîí<br>${cost}`;
                    div.onclick = () => { if(gameData.score >= cost) { gameData.score -= cost; gameData.slots++; renderGarden(); save(); } };
                } else if(!p) {
                    div.innerHTML = '‚ûï';
                    div.onclick = () => { activeSlotIdx = i; openPlantMenu(); };
                } else {
                    let info = FLORA[p.id];
                    div.innerHTML = `<div class="plant rarity-${info.rar}">
                        <div class="icon" style="font-size:1.8rem">${info.i}</div>
                        <div class="bar"><div class="fill" style="width:${p.w}%; background:#3b82f6"></div></div>
                        <div class="bar"><div class="fill" style="width:${p.h}%; background:#22c55e"></div></div>
                    </div>`;
                    div.onclick = () => {
                        if(currentTool === 'water') p.w = Math.min(p.w + 40, 100);
                        if(currentTool === 'food') p.h = Math.min(p.h + 25, 100);
                        if(currentTool === 'trash') gameData.garden[i] = null;
                        renderGarden(); save();
                    };
                }
                g.appendChild(div);
            }
        }

        function openPlantMenu() {
            const grid = document.getElementById('inventoryGrid');
            if(gameData.inventory.length === 0) return alert("–°–Ω–∞—á–∞–ª–∞ –∫—É–ø–∏ —Å–µ–º–µ–Ω–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ!");
            grid.innerHTML = gameData.inventory.map((id, idx) => {
                let p = FLORA[id];
                return `<button class="m-item rarity-${p.rar}" onclick="confirmPlant(${idx})"><span class="icon">${p.i}</span>${p.n}</button>`;
            }).join('');
            toggleOverlay('plantOverlay', true);
        }

        function confirmPlant(invIdx) {
            let id = gameData.inventory.splice(invIdx, 1)[0];
            gameData.garden[activeSlotIdx] = { id, w: 100, h: 100, age: 0 };
            toggleOverlay('plantOverlay', false);
            renderGarden(); save();
        }

        function refreshMarket() {
            marketItems = [FLORA[0]]; // –ü–µ—Ä–≤—ã–π —Å–ª–æ—Ç ‚Äî –≤—Å–µ–≥–¥–∞ –¢—Ä–∞–≤–∞
            for(let i=1; i<6; i++) {
                let p = FLORA[Math.floor(Math.random() * FLORA.length)];
                marketItems.push(Math.random() < p.r ? p : null);
            }
            renderMarketUI();
        }

        function renderMarketUI() {
            const grid = document.getElementById('marketGrid');
            grid.innerHTML = '';
            marketItems.forEach((p, idx) => {
                let div = document.createElement('div');
                div.className = 'm-item' + (p ? ` rarity-${p.rar}` : ' empty');
                if(!p) {
                    div.innerHTML = '–ü–£–°–¢–û';
                } else {
                    div.innerHTML = `<span class="icon">${p.i}</span><div>${p.n}</div>
                    <button class="btn-buy" onclick="buySeed(${idx})">üí∞ ${p.c}</button>`;
                }
                grid.appendChild(div);
            });
        }

        function buySeed(idx) {
            let p = marketItems[idx];
            if(!p) return;
            if(gameData.score >= p.c) {
                gameData.score -= p.c;
                gameData.inventory.push(p.id);
                // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –¢—Ä–∞–≤–∞ –≤ 1 —Å–ª–æ—Ç–µ, —É–±–∏—Ä–∞–µ–º —Ç–æ–≤–∞—Ä
                if(idx !== 0) { marketItems[idx] = null; }
                renderMarketUI();
                document.getElementById('score').innerText = 'üí∞ ' + Math.floor(gameData.score);
                save();
            } else {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–µ–Ω–µ–≥!");
            }
        }

        function toggleOverlay(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
        function setTool(t) {
            currentTool = t;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById('t-'+t).classList.add('active');
        }

        setInterval(() => {
            if(!currentUser) return;
            marketTimer--;
            if(marketTimer <= 0) { marketTimer = 300; refreshMarket(); }
            let m = Math.floor(marketTimer/60), s = marketTimer%60;
            document.getElementById('mTimer').innerText = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${m}:${s<10?'0'+s:s}`;

            let sec = new Date().getSeconds();
            let night = sec >= 30;
            document.getElementById('sky').style.background = night ? 'var(--sky-night)' : 'var(--sky-day)';
            document.getElementById('status').innerText = night ? 'üåô ‚ú®' : '‚òÄÔ∏è ‚òÅÔ∏è';

            gameData.garden.forEach((p, i) => {
                if(p) {
                    p.w = Math.max(0, p.w - (night ? 0.15 : 0.7));
                    p.age += 0.1;
                    if(p.w < 20) p.h -= 0.6;
                    if(p.age >= 50 || p.h <= 0) gameData.garden[i] = null;
                    else if(p.h > 40) gameData.score += (FLORA[p.id].inc / 1);
                }
            });
            document.getElementById('score').innerText = 'üí∞ ' + Math.floor(gameData.score);
            save();
        }, 1000);
    </script>
</body>
</html>
