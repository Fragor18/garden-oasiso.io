<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OASIS ‚Äî Ultimate Fix</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #2e7d32; --bg: #050a05; --accent: #4caf50; 
            --light-green: #98ff98; --card-bg: rgba(255,255,255,0.95);
        }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body, html { 
            margin: 0; padding: 0; height: 100%; width: 100%; 
            font-family: 'Ubuntu', sans-serif; 
            background-color: #0a1a0a; overflow: hidden;
        }

        .main-bg {
            position: fixed; inset: 0; z-index: -1;
            background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.8)), 
                              url('https://images.pexels.com/photos/1072179/pexels-photo-1072179.jpeg?auto=compress&cs=tinysrgb&w=1280');
            background-size: cover; background-position: center;
        }

        /* –ö–†–ê–°–ù–ê–Ø –ö–ù–û–ü–ö–ê –ö–û–ù–°–û–õ–ò - –¢–ï–ü–ï–†–¨ –ü–û–í–ï–†–• –í–°–ï–ì–û */
        .cheat-btn { 
            position: fixed; 
            bottom: 15px; 
            right: 15px; 
            background: #ff0000; 
            color: white; 
            border: 3px solid white; 
            width: 45px; 
            height: 45px; 
            border-radius: 12px; 
            z-index: 999999; 
            cursor: pointer; 
            font-weight: bold;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(255,0,0,0.7);
        }

        #authLayer, #deviceLayer { 
            position: fixed; inset: 0; z-index: 2000; 
            background: rgba(0,0,0,0.98); 
            display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 20px; 
        }
        .card { background: white; color: #333; padding: 30px; border-radius: 30px; width: 100%; max-width: 350px; text-align: center; border: 4px solid var(--primary); }
        .auth-input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: 2px solid #ddd; font-size: 1rem; }

        .layer { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; z-index: 10; padding-top: 110px; padding-bottom: 100px; }
        .hidden { display: none !important; }

        .btn { padding: 12px 20px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; font-family: 'Ubuntu'; text-transform: uppercase; font-size: 0.8rem; }
        .btn-green { background: var(--primary); color: white; }

        .site-header { position: absolute; top: 0; width: 100%; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 100; background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--primary); }

        .garden-container { width: 100%; height: 100%; overflow-y: auto; display: flex; justify-content: center; padding: 10px; }
        .garden-grid { display: grid; gap: 10px; height: max-content; padding-bottom: 100px; }
        
        .is-pc .garden-grid { grid-template-columns: repeat(4, 160px); }
        .is-mobile .garden-grid { grid-template-columns: repeat(2, 1fr); width: 100%; max-width: 360px; }

        .garden-slot { aspect-ratio: 4/5; background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2); border-radius: 20px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        
        .plant-card { width: 100%; height: 100%; background: var(--card-bg); color: #333; border-radius: 18px; padding: 8px; display: flex; flex-direction: column; align-items: center; position: relative; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .earning { animation: pulse 2s infinite ease-in-out; border: 2px solid var(--accent); }

        .plant-icon { font-size: 2.5rem; flex-grow: 1; display: flex; align-items: center; }
        
        .bars-container { width: 100%; display: flex; flex-direction: column; gap: 0; border-radius: 5px; overflow: hidden; border: 1px solid #bbb; }
        .bar { width: 100%; height: 9px; background: #ddd; }
        .fill { height: 100%; transition: 0.4s; width: 0%; }

        .hotbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; background: rgba(0,0,0,0.9); padding: 12px 25px; border-radius: 40px; border: 1px solid var(--primary); z-index: 500; }
        .tool { width: 50px; height: 50px; background: #1a1a1a; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; cursor: pointer; position: relative; overflow: hidden; }
        .tool.active { border: 2px solid var(--accent); background: #222; }
        .cd-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); transform: translateY(100%); transition: transform linear; }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; padding: 20px; }
        .overlay.active { opacity: 1; visibility: visible; }
        .modal { background: white; color: #333; width: 100%; max-width: 380px; padding: 25px; border-radius: 30px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f0f7f0; margin: 10px 0; border-radius: 15px; cursor: pointer; border: 1px solid #ddd; }

        #autoTag { position: fixed; top: 15px; left: 15px; color: #ff0000; font-weight: bold; z-index: 999; font-size: 12px; text-shadow: 1px 1px 0 black; }
    </style>
</head>
<body class="is-pc">
    <div class="main-bg"></div>
    <div id="autoTag" class="hidden">‚óè AUTO-WATER ACTIVE</div>
    
    <button class="cheat-btn" onclick="openConsole()">\</button>

    <div id="authLayer">
        <div class="card">
            <h1 style="color:var(--primary); font-family:Montserrat; margin:0">OASIS</h1>
            <input type="text" id="nameInput" class="auth-input" placeholder="–ù–∏–∫–Ω–µ–π–º">
            <input type="password" id="passInput" class="auth-input" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-green" style="width:100%" onclick="handleAuth()">–í–æ–π—Ç–∏</button>
        </div>
    </div>

    <div id="deviceLayer" class="hidden">
        <div class="card">
            <h3>–í—ã–±–µ—Ä–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</h3>
            <button class="btn btn-green" style="width:100%; margin-bottom:10px" onclick="setDevice('pc')">–ö–æ–º–ø—å—é—Ç–µ—Ä üíª</button>
            <button class="btn btn-green" style="width:100%" onclick="setDevice('mobile')">–¢–µ–ª–µ—Ñ–æ–Ω üì±</button>
        </div>
    </div>

    <div id="gameUI" class="hidden">
        <header class="site-header">
            <div style="color:var(--accent); font-weight:bold; font-family:Montserrat">OASIS PRO</div>
            <div style="display:flex; align-items:center; gap:15px">
                <span id="scoreDisplay" style="color:white; font-weight:bold; font-size:1.1rem">üí∞ 0</span>
                <button onclick="location.reload()" style="background:none; border:none; color:white; font-size:1.4rem; cursor:pointer">üö™</button>
            </div>
        </header>

        <nav style="position: absolute; top: 60px; display: flex; gap: 8px; z-index: 100;">
            <button class="btn btn-green" onclick="showPage('mainPage')">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="btn btn-green" onclick="showPage('gardenPage')">–ú–æ–π –°–∞–¥</button>
        </nav>

        <div id="mainPage" class="layer">
            <h1 style="color:var(--light-green); font-family:Montserrat; text-shadow: 2px 2px 5px black;">–ê–ö–ê–î–ï–ú–ò–Ø</h1>
            <div style="display:flex; flex-direction:column; gap:12px; width:240px">
                <button class="btn btn-green" onclick="openCatalog()" style="font-size:1rem">üìö –ö–ê–¢–ê–õ–û–ì –°–ï–ú–Ø–ù</button>
                <button class="btn btn-green" style="background:#f39c12; font-size:1rem" onclick="openLeaderboard()">üèÜ –õ–ò–î–ï–†–´</button>
            </div>
        </div>

        <div id="gardenPage" class="layer hidden">
            <div class="garden-container">
                <div class="garden-grid" id="gardenGrid"></div>
            </div>
            
            <div class="hotbar">
                <div class="tool active" id="t-water" onclick="setTool('water')">
                    üíß <div id="cd-water" class="cd-overlay"></div>
                </div>
                <div class="tool" id="t-food" onclick="setTool('food')">
                    üß™ <div id="cd-food" class="cd-overlay"></div>
                </div>
                <div class="tool" id="t-trash" onclick="setTool('trash')">
                    üóëÔ∏è
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="modalOverlay"><div class="modal" id="modalContent"></div></div>

    <script>
        const plants = [
            { id: 0, name: '–ú–æ–Ω—Å—Ç–µ—Ä–∞', icon: 'üåø', income: 3, testCost: 0 },
            { id: 1, name: '–ö–∞–∫—Ç—É—Å', icon: 'üåµ', income: 15, testCost: 500 },
            { id: 2, name: '–ú—É—Ö–æ–ª–æ–≤–∫–∞', icon: 'ü™¥', income: 60, testCost: 4000 },
            { id: 3, name: '–ë–∞–º–±—É–∫', icon: 'üéã', income: 250, testCost: 20000 },
            { id: 4, name: '–û–∞–∑–∏—Å', icon: 'üíé', income: 2500, testCost: 100000 }
        ];

        let currentUser = null;
        let gameData = { score: 0, unlocked: [0], garden: new Array(12).fill(null) };
        let currentTool = 'water', isAutoWater = false;
        let cooldowns = { water: false, food: false };
        const STORAGE_KEY = 'oasis_ultimate_v40';

        function openConsole() {
            let code = prompt("–ß–ò–¢-–ö–û–î–´:\nmoney - +1–º–ª–Ω\nunlock - –æ—Ç–∫—Ä—ã—Ç—å –≤—Å–µ\nwater - –ø–æ–ª–∏—Ç—å –≤—Å—ë\nauto - –∞–≤—Ç–æ-–ø–æ–ª–∏–≤\nclear - –æ—á–∏—Å—Ç–∏—Ç—å");
            if(!code) return;
            code = code.toLowerCase();
            if(code === 'money') gameData.score += 1000000;
            if(code === 'unlock') gameData.unlocked = [0,1,2,3,4];
            if(code === 'water') gameData.garden.forEach(p => { if(p) p.w = 100; });
            if(code === 'auto') {
                isAutoWater = !isAutoWater;
                document.getElementById('autoTag').classList.toggle('hidden', !isAutoWater);
            }
            if(code === 'clear') gameData.garden = new Array(12).fill(null);
            save(); renderGarden();
        }

        function handleAuth() {
            const name = document.getElementById('nameInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();
            if(!name || !pass) return;
            let users = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            if(users[name]) {
                if(users[name].pass !== pass) return alert("–ü–∞—Ä–æ–ª—å!");
                gameData = users[name].data;
            } else {
                users[name] = { pass, data: { score: 0, unlocked: [0], garden: new Array(12).fill(null) } };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
                gameData = users[name].data;
            }
            currentUser = name;
            document.getElementById('authLayer').classList.add('hidden');
            document.getElementById('deviceLayer').classList.remove('hidden');
        }

        function setDevice(type) {
            document.body.className = (type === 'pc') ? 'is-pc' : 'is-mobile';
            document.getElementById('deviceLayer').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            renderGarden();
        }

        function setTool(t) {
            currentTool = t;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById('t-'+t).classList.add('active');
        }

        function triggerCooldown(tool, ms) {
            cooldowns[tool] = true;
            const overlay = document.getElementById('cd-' + tool);
            overlay.style.transition = 'none'; overlay.style.transform = 'translateY(0%)';
            setTimeout(() => {
                overlay.style.transition = `transform ${ms}ms linear`;
                overlay.style.transform = 'translateY(100%)';
            }, 10);
            setTimeout(() => { cooldowns[tool] = false; }, ms);
        }

        function handleSlot(i) {
            if(!gameData.garden[i]) {
                let h = '<h2>–ü–æ—Å–∞–¥–∏—Ç—å</h2>';
                plants.forEach((p, idx) => {
                    if(gameData.unlocked.includes(idx)) {
                        h += `<div class="item-row" onclick="plantNow(${i}, ${p.id})">
                                <span>${p.icon} ${p.name}</span>
                                <span>üå±</span>
                              </div>`;
                    }
                });
                document.getElementById('modalContent').innerHTML = h + `<button class="btn btn-green" style="width:100%" onclick="closeM()">–ó–∞–∫—Ä—ã—Ç—å</button>`;
                document.getElementById('modalOverlay').classList.add('active');
            } else {
                let p = gameData.garden[i];
                if(currentTool === 'water' && !cooldowns.water) { p.w = Math.min(p.w + 40, 100); triggerCooldown('water', 1000); }
                if(currentTool === 'food' && !cooldowns.food) { p.h = Math.min(p.h + 30, 100); triggerCooldown('food', 2000); }
                if(currentTool === 'trash') gameData.garden[i] = null;
                save(); renderGarden();
            }
        }

        function plantNow(s, id) { gameData.garden[s] = {id, w: 100, h: 100}; closeM(); save(); renderGarden(); }

        function renderGarden() {
            const g = document.getElementById('gardenGrid'); if(!g) return;
            g.innerHTML = gameData.garden.map((p, i) => {
                if(!p) return `<div class="garden-slot" onclick="handleSlot(${i})">‚ûï</div>`;
                const info = plants.find(x => x.id === p.id);
                return `<div class="garden-slot" onclick="handleSlot(${i})">
                    <div class="plant-card ${p.h > 40 ? 'earning' : ''}">
                        <div class="plant-icon">${info.icon}</div>
                        <div class="bars-container">
                            <div class="bar"><div class="fill" style="width:${p.w}%; background:#2196f3"></div></div>
                            <div class="bar"><div class="fill" style="width:${p.h}%; background:#4caf50"></div></div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        function openCatalog() {
            let h = '<h2>–ú–ê–ì–ê–ó–ò–ù –°–ï–ú–Ø–ù</h2>';
            plants.forEach((p, i) => {
                const isU = gameData.unlocked.includes(i);
                const prevU = (i === 0) || gameData.unlocked.includes(i - 1);
                
                if(isU) {
                    h += `<div class="item-row" style="background:#e8f5e9"><span>${p.icon} ${p.name}</span><span style="color:green">–û–¢–ö–†–´–¢–û</span></div>`;
                } else if(prevU) {
                    h += `<div class="item-row" onclick="unlockP(${i})"><span>${p.icon} ${p.name}</span><span style="font-weight:bold">üí∞ ${p.testCost}</span></div>`;
                } else {
                    h += `<div class="item-row" style="opacity:0.3"><span>üîí ???</span></div>`;
                }
            });
            document.getElementById('modalContent').innerHTML = h + `<button class="btn btn-green" style="width:100%; margin-top:10px" onclick="closeM()">–ù–ê–ó–ê–î</button>`;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function unlockP(idx) {
            if(gameData.score >= plants[idx].testCost) {
                gameData.score -= plants[idx].testCost;
                gameData.unlocked.push(idx);
                save(); openCatalog();
            } else alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç!");
        }

        function openLeaderboard() {
            let users = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            let list = Object.keys(users).map(n => ({ n, s: Math.floor(users[n].data.score) })).sort((a,b)=>b.s-a.s);
            let h = '<h2>–¢–û–ü –°–ê–î–û–í–û–î–û–í</h2>';
            list.slice(0, 8).forEach((u,i) => h += `<div class="item-row"><span>${i+1}. ${u.n}</span><span>üí∞ ${u.s}</span></div>`);
            document.getElementById('modalContent').innerHTML = h + `<button class="btn btn-green" style="width:100%" onclick="closeM()">–ó–ê–ö–†–´–¢–¨</button>`;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function save() {
            if(!currentUser) return;
            let users = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            users[currentUser].data = gameData;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(users));
        }

        function closeM() { document.getElementById('modalOverlay').classList.remove('active'); }
        function showPage(p) {
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('gardenPage').classList.add('hidden');
            document.getElementById(p).classList.remove('hidden');
            renderGarden();
        }

        setInterval(() => {
            if(!currentUser) return;
            let totalIncome = 0;
            gameData.garden.forEach(p => {
                if(p) {
                    p.w = Math.max(p.w - 0.7, 0); 
                    if(p.w < 25) p.h = Math.max(p.h - 1.2, 0); 
                    if(p.h > 40) totalIncome += plants.find(x => x.id === p.id).income;
                    if(isAutoWater && p.w < 50) p.w = 100;
                }
            });
            gameData.score += totalIncome;
            document.getElementById('scoreDisplay').innerText = `üí∞ ${Math.floor(gameData.score)}`;
            if(!document.getElementById('gardenPage').classList.contains('hidden')) renderGarden();
            save();
        }, 1000);
    </script>
</body>
</html>
