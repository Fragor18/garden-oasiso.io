<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OASIS 22 ‚Äî Mega Flora</title>
    <style>
        :root { 
            --p: #2e7d32; --bg: #000; 
            --sky-day: #4facfe; --sky-night: #0a0f1e;
            --r0: #2ecc71; --r1: #3498db; --r2: #9b59b6; --r3: #f1c40f; --r4: #e74c3c;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: white; height: 100vh; overflow: hidden; }
        #sky { position: fixed; inset: 0; z-index: -1; transition: 3s; background: var(--sky-day); }

        /* AUTH */
        #authScreen { position: fixed; inset: 0; z-index: 5000; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .auth-card { background: white; color: #333; padding: 25px; border-radius: 20px; width: 100%; max-width: 320px; text-align: center; }
        .auth-card input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #ccc; font-size: 16px; }

        /* HEADER */
        .header { background: rgba(0,0,0,0.8); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--p); z-index: 10; position: relative; }
        .score { font-size: 1.1rem; font-weight: bold; color: #4caf50; }

        /* GARDEN */
        .main-container { height: calc(100vh - 130px); overflow-y: auto; padding: 10px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; align-content: start; z-index: 5; position: relative; }
        @media (min-width: 600px) { .main-container { grid-template-columns: repeat(4, 1fr); } }

        .slot { aspect-ratio: 1/1.2; background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .slot.locked { background: rgba(0,0,0,0.5); color: #444; }
        
        .plant { background: white; color: #333; width: 92%; height: 92%; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 5px; border-top: 5px solid #ccc; }
        
        /* RARITY STYLES */
        .rarity-0 { border-color: var(--r0) !important; box-shadow: 0 0 5px var(--r0); }
        .rarity-1 { border-color: var(--r1) !important; box-shadow: 0 0 5px var(--r1); }
        .rarity-2 { border-color: var(--r2) !important; box-shadow: 0 0 8px var(--r2); }
        .rarity-3 { border-color: var(--r3) !important; box-shadow: 0 0 10px var(--r3); }
        .rarity-4 { border-color: var(--r4) !important; box-shadow: 0 0 15px var(--r4); animation: glow 1s infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 5px var(--r4); } to { box-shadow: 0 0 20px var(--r4); } }

        .bar { width: 80%; height: 5px; background: #eee; border-radius: 3px; overflow: hidden; margin: 1px 0; }
        .fill { height: 100%; transition: 0.3s; }

        /* OVERLAYS */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; display: none; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; }
        .m-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 400px; margin-top: 15px; }
        .m-item { background: white; color: #333; padding: 10px; border-radius: 10px; text-align: center; border: none; font-weight: bold; border-top: 4px solid #ccc; }
        .m-item.empty { background: #222; color: #444; border: 1px dashed #444; }

        .toolbar { position: fixed; bottom: 0; width: 100%; background: #111; padding: 10px; display: flex; justify-content: center; gap: 15px; border-top: 2px solid var(--p); z-index: 10; }
        .tool { font-size: 1.5rem; padding: 10px; background: #222; border-radius: 10px; cursor: pointer; opacity: 0.3; }
        .tool.active { opacity: 1; border: 2px solid #4caf50; }

        .btn { background: var(--p); color: white; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-buy { background: var(--p); color: white; border: none; padding: 6px; width: 100%; border-radius: 5px; margin-top: 5px; font-size: 11px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="sky"></div>

    <div id="authScreen">
        <div class="auth-card">
            <h2 style="margin-top:0; color:var(--p)">OASIS LOGIN</h2>
            <input type="text" id="userLogin" placeholder="–õ–æ–≥–∏–Ω">
            <input type="password" id="userPass" placeholder="–ü–∞—Ä–æ–ª—å">
            <div style="display:flex; gap:10px; margin-top:10px">
                <button class="btn" style="flex:1" onclick="handleAuth(true)">–í–û–ô–¢–ò</button>
                <button class="btn" style="flex:1; background:#444" onclick="handleAuth(false)">–†–ï–ì</button>
            </div>
            <p id="authMsg" style="font-size:12px; color:red; margin-top:10px"></p>
        </div>
    </div>

    <div id="gameUI" class="hidden">
        <div class="header">
            <div class="score" id="score">üí∞ 150</div>
            <div id="status">‚òÄÔ∏è ‚òÅÔ∏è</div>
            <button class="btn" onclick="toggleOverlay('marketOverlay', true)">üõí –†–´–ù–û–ö</button>
        </div>
        <div class="main-container" id="garden"></div>
        <div class="toolbar">
            <div class="tool active" id="t-water" onclick="setTool('water')">üíß</div>
            <div class="tool" id="t-food" onclick="setTool('food')">üß™</div>
            <div class="tool" id="t-trash" onclick="setTool('trash')">üóëÔ∏è</div>
        </div>
    </div>

    <div class="overlay" id="marketOverlay">
        <h2>–ú–ê–ì–ê–ó–ò–ù</h2>
        <p id="mTimer" style="font-size: 12px; color: #888;">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 05:00</p>
        <div class="m-grid" id="marketGrid"></div>
        <button class="btn" style="margin-top: 20px; background: #7d2e2e;" onclick="toggleOverlay('marketOverlay', false)">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div class="overlay" id="plantOverlay">
        <h2>–°–ï–ú–ï–ù–ê</h2>
        <div class="m-grid" id="inventoryGrid"></div>
        <button class="btn" style="margin-top: 20px; background: #7d2e2e;" onclick="toggleOverlay('plantOverlay', false)">–û–¢–ú–ï–ù–ê</button>
    </div>

    <script>
        const FLORA = [
            { id: 0, n: '–¢—Ä–∞–≤–∞', i: 'üå±', inc: 1, c: 20, r: 0.9, rar: 0 },
            { id: 1, n: '–†–æ–º–∞—à–∫–∞', i: 'üåº', inc: 4, c: 100, r: 0.8, rar: 0 },
            { id: 2, n: '–ú—è—Ç–∞', i: 'üåø', inc: 8, c: 250, r: 0.8, rar: 0 },
            { id: 3, n: '–û–¥—É–≤–∞–Ω—á–∏–∫', i: 'üèµÔ∏è', inc: 12, c: 500, r: 0.7, rar: 0 },
            { id: 4, n: '–ö–∞–∫—Ç—É—Å', i: 'üåµ', inc: 25, c: 1200, r: 0.6, rar: 1 },
            { id: 5, n: '–¢—é–ª—å–ø–∞–Ω', i: 'üå∑', inc: 50, c: 3000, r: 0.6, rar: 1 },
            { id: 6, n: '–•–ª–æ–ø–æ–∫', i: '‚òÅÔ∏è', inc: 80, c: 7000, r: 0.5, rar: 1 },
            { id: 7, n: '–ü–æ–¥—Å–æ–ª–Ω—É—Ö', i: 'üåª', inc: 150, c: 15000, r: 0.5, rar: 1 },
            { id: 8, n: '–†–æ–∑–∞', i: 'üåπ', inc: 400, c: 40000, r: 0.4, rar: 2 },
            { id: 9, n: '–õ–∞–≤–∞–Ω–¥–∞', i: '‚öõÔ∏è', inc: 700, c: 85000, r: 0.4, rar: 2 },
            { id: 10, n: '–õ–∏–ª–∏—è', i: 'ü™∑', inc: 1200, c: 150000, r: 0.3, rar: 2 },
            { id: 11, n: '–ü–∞–ª—å–º–∞', i: 'üå¥', inc: 3000, c: 400000, r: 0.3, rar: 2 },
            { id: 12, n: '–ë–∞–º–±—É–∫', i: 'üéã', inc: 8000, c: 1000000, r: 0.2, rar: 3 },
            { id: 13, n: '–ï–ª—å', i: 'üå≤', inc: 15000, c: 2500000, r: 0.2, rar: 3 },
            { id: 14, n: '–ú—É—Ö–æ–ª–æ–≤–∫–∞', i: 'ü™¥', inc: 40000, c: 7000000, r: 0.15, rar: 3 },
            { id: 15, n: '–ì—Ä–∏–±', i: 'üçÑ', inc: 90000, c: 15000000, r: 0.1, rar: 3 },
            { id: 16, n: '–í–∏—à–Ω—è', i: 'üçí', inc: 250000, c: 50000000, r: 0.08, rar: 4 },
            { id: 17, n: '–û—Ä–µ—Ö', i: 'üå∞', inc: 600000, c: 150000000, r: 0.06, rar: 4 },
            { id: 18, n: '–õ–æ—Ç–æ—Å', i: 'üíÆ', inc: 1500000, c: 500000000, r: 0.04, rar: 4 },
            { id: 19, n: '–ê—Ä–±—É–∑', i: 'üçâ', inc: 5000000, c: 2000000000, r: 0.03, rar: 4 },
            { id: 20, n: '–î—Ä–∞–∫–æ–Ω', i: 'üêâ', inc: 15000000, c: 8000000000, r: 0.02, rar: 4 },
            { id: 21, n: '–ó–≤–µ–∑–¥–∞', i: '‚ú®', inc: 50000000, c: 25000000000, r: 0.01, rar: 4 }
        ];

        let currentUser = null;
        let gameData = { score: 150, slots: 3, garden: new Array(16).fill(null), inventory: [0] };
        let marketItems = [];
        let marketTimer = 300;
        let currentTool = 'water';
        let activeSlotIdx = null;

        function handleAuth(isLogin) {
            const login = document.getElementById('userLogin').value.trim().toLowerCase();
            const pass = document.getElementById('userPass').value.trim();
            const msg = document.getElementById('authMsg');
            if(!login || !pass) return msg.innerText = "–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!";
            let users = JSON.parse(localStorage.getItem('oasis_users') || '{}');
            if(isLogin) {
                if(users[login] && users[login].pass === pass) { currentUser = login; gameData = users[login].data; startGame(); }
                else { msg.innerText = "–û—à–∏–±–∫–∞!"; }
            } else {
                if(users[login]) { msg.innerText = "–ó–∞–Ω—è—Ç–æ!"; }
                else { users[login] = { pass, data: { score: 150, slots: 3, garden: new Array(16).fill(null), inventory: [0] } }; localStorage.setItem('oasis_users', JSON.stringify(users)); msg.innerText = "–£—Å–ø–µ—Ö!"; }
            }
        }

        function save() {
            if(!currentUser) return;
            let users = JSON.parse(localStorage.getItem('oasis_users') || '{}');
            users[currentUser].data = gameData;
            localStorage.setItem('oasis_users', JSON.stringify(users));
        }

        function startGame() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('gameUI').classList.remove('hidden');
            refreshMarket();
            renderGarden();
        }

        function renderGarden() {
            const g = document.getElementById('garden');
            g.innerHTML = '';
            for(let i=0; i<16; i++) {
                let p = gameData.garden[i];
                let locked = i >= gameData.slots;
                let div = document.createElement('div');
                div.className = 'slot' + (locked ? ' locked' : '');
                if(locked) {
                    let cost = gameData.slots * 3000;
                    div.innerHTML = `üîí<br><small>${cost}</small>`;
                    div.onclick = () => { if(gameData.score >= cost) { gameData.score -= cost; gameData.slots++; renderGarden(); save(); } };
                } else if(!p) {
                    div.innerHTML = '‚ûï';
                    div.onclick = () => { activeSlotIdx = i; openPlantMenu(); };
                } else {
                    let info = FLORA[p.id];
                    div.innerHTML = `<div class="plant rarity-${info.rar}">
                        <span style="font-size:9px">${Math.floor(p.age)}/50</span>
                        <div style="font-size:2.3rem">${info.i}</div>
                        <div class="bar"><div class="fill" style="width:${p.w}%; background:#3b82f6"></div></div>
                        <div class="bar"><div class="fill" style="width:${p.h}%; background:#22c55e"></div></div>
                    </div>`;
                    div.onclick = () => {
                        if(currentTool === 'water') p.w = Math.min(p.w + 40, 100);
                        if(currentTool === 'food') p.h = Math.min(p.h + 25, 100);
                        if(currentTool === 'trash') gameData.garden[i] = null;
                        renderGarden(); save();
                    };
                }
                g.appendChild(div);
            }
        }

        function openPlantMenu() {
            const grid = document.getElementById('inventoryGrid');
            if(gameData.inventory.length === 0) return alert("–ü—É—Å—Ç–æ!");
            grid.innerHTML = gameData.inventory.map((id, idx) => {
                let p = FLORA[id];
                return `<button class="m-item rarity-${p.rar}" onclick="confirmPlant(${idx})">${p.i} ${p.n}</button>`;
            }).join('');
            toggleOverlay('plantOverlay', true);
        }

        function confirmPlant(invIdx) {
            let id = gameData.inventory.splice(invIdx, 1)[0];
            gameData.garden[activeSlotIdx] = { id, w: 100, h: 100, age: 0 };
            toggleOverlay('plantOverlay', false);
            renderGarden(); save();
        }

        function refreshMarket() {
            marketItems = [];
            for(let i=0; i<6; i++) {
                let p = FLORA[Math.floor(Math.random() * FLORA.length)];
                marketItems.push(Math.random() < p.r ? p : null);
            }
            renderMarketUI();
        }

        function renderMarketUI() {
            const grid = document.getElementById('marketGrid');
            grid.innerHTML = marketItems.map((p, idx) => {
                if(!p) return `<div class="m-item empty">–ü–£–°–¢–û</div>`;
                return `<div class="m-item rarity-${p.rar}">
                    <div style="font-size:1.5rem">${p.i}</div>
                    <div style="font-size:10px">${p.n}</div>
                    <button class="btn-buy" onclick="buySeed(${idx})">üí∞ ${p.c}</button>
                </div>`;
            }).join('');
        }

        function buySeed(idx) {
            let p = marketItems[idx];
            if(gameData.score >= p.c) {
                gameData.score -= p.c;
                gameData.inventory.push(p.id);
                marketItems[idx] = null;
                renderMarketUI(); save();
            }
        }

        function toggleOverlay(id, show) { document.getElementById(id).style.display = show ? 'flex' : 'none'; }
        function setTool(t) {
            currentTool = t;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById('t-'+t).classList.add('active');
        }

        setInterval(() => {
            if(!currentUser) return;
            marketTimer--;
            if(marketTimer <= 0) { marketTimer = 300; refreshMarket(); }
            let m = Math.floor(marketTimer/60), s = marketTimer%60;
            document.getElementById('mTimer').innerText = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${m}:${s<10?'0'+s:s}`;

            let sec = new Date().getSeconds();
            let night = sec >= 30;
            document.getElementById('sky').style.background = night ? 'var(--sky-night)' : 'var(--sky-day)';
            document.getElementById('status').innerText = night ? 'üåô ‚ú®' : '‚òÄÔ∏è ‚òÅÔ∏è';

            gameData.garden.forEach((p, i) => {
                if(p) {
                    p.w = Math.max(0, p.w - (night ? 0.15 : 0.7));
                    p.age += 0.1;
                    if(p.w < 20) p.h -= 0.6;
                    if(p.age >= 50 || p.h <= 0) gameData.garden[i] = null;
                    else if(p.h > 40) gameData.score += FLORA[p.id].inc;
                }
            });
            document.getElementById('score').innerText = 'üí∞ ' + Math.floor(gameData.score);
            save();
        }, 1000);
    </script>
</body>
</html>
