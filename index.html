<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OASIS 2026 ‚Äî Age Update</title>
    <style>
        :root { 
            --p: #2e7d32; --bg: #000; 
            --sky-day: #4facfe; --sky-night: #0a0f1e;
            --r0: #2ecc71; --r1: #3498db; --r2: #9b59b6; --r3: #f1c40f; --r4: #e74c3c;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; height: 100vh; overflow: hidden; }
        
        #sky { position: fixed; inset: 0; z-index: -1; transition: 3s; background: var(--sky-day); }

        /* –ú–ï–ù–Æ */
        #startMenu { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .logo { font-size: 3.5rem; font-weight: 900; color: var(--p); text-shadow: 0 0 20px var(--p); letter-spacing: 5px; margin-bottom: 30px; }
        .auth-box { width: 85%; max-width: 320px; }
        .auth-box input { width: 100%; padding: 15px; margin-bottom: 10px; border-radius: 12px; border: none; background: #222; color: white; font-size: 16px; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        .game-ui { display: none; height: 100vh; flex-direction: column; }
        .header { background: rgba(0,0,0,0.85); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--p); }
        .score { font-size: 1.1rem; color: #4caf50; font-weight: bold; }

        /* –°–ê–î */
        .garden { flex: 1; display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; padding: 10px; align-content: start; overflow-y: auto; }
        .slot { aspect-ratio: 1/1.3; background: rgba(255,255,255,0.05); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; position: relative; }
        .slot.locked { background: rgba(0,0,0,0.4); color: #444; font-size: 9px; text-align: center; }
        
        .plant { width: 95%; height: 95%; background: white; border-radius: 8px; border-top: 4px solid #ccc; display: flex; flex-direction: column; align-items: center; justify-content: space-evenly; padding: 2px; }
        .bar { width: 85%; height: 3px; background: #eee; border-radius: 2px; overflow: hidden; margin: 1px 0; }
        .fill { height: 100%; transition: 0.3s; }

        /* –û–ö–ù–ê */
        .overlay { position: fixed; inset: 0; background: #000; z-index: 8000; display: none; flex-direction: column; padding: 20px; }
        .m-list { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 500px; align-self: center; }
        
        .m-card { background: white; color: #333; padding: 15px; border-radius: 20px; display: flex; align-items: center; gap: 15px; border-left: 10px solid #ccc; transition: 0.3s; position: relative; }
        .m-card.locked { background: #1a1a1a; color: #444; border-color: #333 !important; }
        .m-card.bought { transform: scale(0.9); opacity: 0; pointer-events: none; }
        .m-card .icon { font-size: 3rem; }
        .m-card .info { flex: 1; }
        .buy-btn { background: var(--p); color: white; border: none; padding: 12px 18px; border-radius: 12px; font-weight: bold; min-width: 90px; }
        .buy-btn.success { background: #2ecc71 !important; }

        /* –¢–£–õ–ë–ê–† */
        .toolbar { padding: 15px; background: #111; display: flex; justify-content: center; gap: 15px; border-top: 1px solid var(--p); }
        .tool { width: 60px; height: 60px; background: #222; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; position: relative; overflow: hidden; border: 2px solid transparent; }
        .tool.active { border-color: #4caf50; }
        .tool.cooldown::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(76, 175, 80, 0.4); animation: cd 1.5s linear forwards; }
        
        @keyframes cd { from { height: 100%; } to { height: 0%; } }

        .btn { padding: 10px 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-p { background: var(--p); color: white; width: 100%; margin-top: 10px; padding: 15px; }
        
        /* –†–ï–î–ö–û–°–¢–¨ */
        .rarity-0 { border-color: var(--r0) !important; }
        .rarity-1 { border-color: var(--r1) !important; }
        .rarity-2 { border-color: var(--r2) !important; }
        .rarity-3 { border-color: var(--r3) !important; }
        .rarity-4 { border-color: var(--r4) !important; box-shadow: 0 0 10px rgba(231, 76, 60, 0.3); }
    </style>
</head>
<body>

    <div id="sky"></div>

    <div id="startMenu">
        <div class="logo">OASIS</div>
        <div class="auth-box">
            <input type="text" id="loginInp" placeholder="–¢–≤–æ–π –Ω–∏–∫">
            <input type="password" id="passInp" placeholder="–ü–∞—Ä–æ–ª—å">
            <button class="btn btn-p" onclick="auth(true)">–ò–ì–†–ê–¢–¨</button>
            <button class="btn" style="background:none; color:#555; width:100%; margin-top:10px" onclick="auth(false)">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
            <p id="msg" style="font-size:12px; color:#e74c3c; text-align:center; margin-top:10px"></p>
        </div>
    </div>

    <div id="gameUI" class="game-ui">
        <div class="header">
            <div class="score" id="score">üí∞ 150</div>
            <div style="display:flex; gap:5px">
                <button class="btn" style="background:#444" onclick="openAtlas()">üìñ –ê–¢–õ–ê–°</button>
                <button class="btn" style="background:var(--p)" onclick="openMarket()">üõí –†–´–ù–û–ö</button>
            </div>
        </div>
        <div class="garden" id="garden"></div>
        <div class="toolbar">
            <div class="tool active" id="tool-water" onclick="setTool('water')">üíß</div>
            <div class="tool" id="tool-food" onclick="setTool('food')">üß™</div>
            <div class="tool" id="tool-trash" onclick="setTool('trash')">üóëÔ∏è</div>
        </div>
    </div>

    <div id="marketOverlay" class="overlay">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
            <h2 style="margin:0">–†–´–ù–û–ö</h2>
            <button class="btn" style="background:#444" onclick="closeOverlay('marketOverlay')">–ó–ê–ö–†–´–¢–¨</button>
        </div>
        <p id="mTimer" style="color:#666; margin-top:-15px; margin-bottom:15px; font-size:13px">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 05:00</p>
        <div class="m-list" id="marketList"></div>
    </div>

    <div id="bagOverlay" class="overlay">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
            <h2 style="margin:0">–°–£–ú–ö–ê</h2>
            <button class="btn" style="background:#444" onclick="closeOverlay('bagOverlay')">–ó–ê–ö–†–´–¢–¨</button>
        </div>
        <div class="m-list" id="bagList"></div>
    </div>

    <div id="atlasOverlay" class="overlay">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
            <h2 style="margin:0">–ê–¢–õ–ê–°</h2>
            <button class="btn" style="background:#444" onclick="closeOverlay('atlasOverlay')">–ó–ê–ö–†–´–¢–¨</button>
        </div>
        <div class="m-list" id="atlasList"></div>
    </div>

    <script>
        // –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ life (–º–∞–∫—Å. –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
        const FLORA = [
            { id: 0, n: '–¢—Ä–∞–≤–∞', i: 'üå±', inc: 1, c: 20, r: 1.0, rar: 0, life: 60 },
            { id: 1, n: '–†–æ–º–∞—à–∫–∞', i: 'üåº', inc: 6, c: 200, r: 0.8, rar: 0, life: 90 },
            { id: 2, n: '–ú—è—Ç–∞', i: 'üåø', inc: 15, c: 600, r: 0.8, rar: 0, life: 120 },
            { id: 3, n: '–ö–∞–∫—Ç—É—Å', i: 'üåµ', inc: 45, c: 2500, r: 0.6, rar: 1, life: 200 },
            { id: 4, n: '–¢—é–ª—å–ø–∞–Ω', i: 'üå∑', inc: 100, c: 6000, r: 0.6, rar: 1, life: 150 },
            { id: 5, n: '–ü–æ–¥—Å–æ–ª–Ω—É—Ö', i: 'üåª', inc: 300, c: 30000, r: 0.5, rar: 1, life: 180 },
            { id: 6, n: '–†–æ–∑–∞', i: 'üåπ', inc: 700, c: 90000, r: 0.4, rar: 2, life: 240 },
            { id: 7, n: '–ü–∞–ª—å–º–∞', i: 'üå¥', inc: 6000, c: 800000, r: 0.3, rar: 2, life: 500 },
            { id: 8, n: '–ë–∞–º–±—É–∫', i: 'üéã', inc: 20000, c: 3500000, r: 0.2, rar: 3, life: 400 },
            { id: 9, n: '–ï–ª—å', i: 'üå≤', inc: 50000, c: 10000000, r: 0.2, rar: 3, life: 600 },
            { id: 10, n: '–ó–≤–µ–∑–¥–∞', i: '‚ú®', inc: 200000000, c: 80000000000, r: 0.01, rar: 4, life: 1000 }
        ];

        let currentUser = null;
        let gameData = { score: 150, slots: 5, garden: new Array(25).fill(null), inventory: [0], unlocked: [0] };
        let currentTool = 'water', toolCD = false, marketItems = [], marketTimer = 300;

        function auth(isLogin) {
            const login = document.getElementById('loginInp').value.trim().toLowerCase();
            const pass = document.getElementById('passInp').value;
            const msg = document.getElementById('msg');
            if(!login || !pass) return msg.innerText = "–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!";
            let users = JSON.parse(localStorage.getItem('oasis_v6') || '{}');
            if(isLogin) {
                if(users[login] && users[login].pass === pass) {
                    currentUser = login; gameData = users[login].data;
                    document.getElementById('startMenu').style.display = 'none';
                    document.getElementById('gameUI').style.display = 'flex';
                    startGame();
                } else msg.innerText = "–û—à–∏–±–∫–∞!";
            } else {
                if(users[login]) msg.innerText = "–ó–∞–Ω—è—Ç–æ!";
                else {
                    users[login] = { pass, data: { score: 150, slots: 5, garden: new Array(25).fill(null), inventory: [0], unlocked: [0] } };
                    localStorage.setItem('oasis_v6', JSON.stringify(users));
                    msg.style.color = "green"; msg.innerText = "–û–ö! –í–æ–π–¥–∏—Ç–µ.";
                }
            }
        }

        function save() {
            if(!currentUser) return;
            let users = JSON.parse(localStorage.getItem('oasis_v6') || '{}');
            users[currentUser].data = gameData;
            localStorage.setItem('oasis_v6', JSON.stringify(users));
        }

        function startGame() { refreshMarket(); renderGarden(); setInterval(tick, 1000); }

        function renderGarden() {
            const g = document.getElementById('garden'); g.innerHTML = '';
            for(let i=0; i<25; i++) {
                let p = gameData.garden[i], locked = i >= gameData.slots, div = document.createElement('div');
                div.className = 'slot' + (locked ? ' locked' : '');
                if(locked) {
                    let cost = gameData.slots * 5000;
                    div.innerHTML = `üîí<br>${cost}`;
                    div.onclick = () => { if(gameData.score >= cost) { gameData.score -= cost; gameData.slots++; renderGarden(); save(); } };
                } else if(!p) {
                    div.innerHTML = '+';
                    div.onclick = () => openBag(i);
                } else {
                    let info = FLORA[p.id];
                    let agePerc = ((info.life - p.age) / info.life) * 100;
                    div.innerHTML = `<div class="plant rarity-${info.rar}">
                        <div style="font-size:1.6rem">${info.i}</div>
                        <div class="bar" title="–í–æ–¥–∞"><div class="fill" style="width:${p.w}%; background:#3b82f6"></div></div>
                        <div class="bar" title="–ó–¥–æ—Ä–æ–≤—å–µ"><div class="fill" style="width:${p.h}%; background:#22c55e"></div></div>
                        <div class="bar" title="–í–æ–∑—Ä–∞—Å—Ç"><div class="fill" style="width:${agePerc}%; background:#f1c40f"></div></div>
                    </div>`;
                    div.onclick = () => useTool(i);
                }
                g.appendChild(div);
            }
        }

        function setTool(t) {
            currentTool = t;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById('tool-'+t).classList.add('active');
        }

        function useTool(idx) {
            if(toolCD) return;
            let p = gameData.garden[idx];
            if(currentTool === 'trash') { gameData.garden[idx] = null; renderGarden(); return; }
            p[currentTool === 'water' ? 'w' : 'h'] = Math.min(p[currentTool === 'water' ? 'w' : 'h'] + 35, 100);
            toolCD = true;
            document.getElementById('tool-'+currentTool).classList.add('cooldown');
            setTimeout(() => { toolCD = false; document.getElementById('tool-'+currentTool).classList.remove('cooldown'); }, 1500);
            renderGarden(); save();
        }

        function openMarket() {
            document.getElementById('marketOverlay').style.display = 'flex';
            const list = document.getElementById('marketList'); list.innerHTML = '';
            marketItems.forEach((p, idx) => {
                if(!p) return;
                let card = document.createElement('div');
                card.className = `m-card rarity-${p.rar}`; card.id = `m-card-${idx}`;
                card.innerHTML = `<div class="icon">${p.i}</div>
                    <div class="info"><b>${p.n}</b><br><small>–î–æ—Ö–æ–¥: ${p.inc}/—Å</small></div>
                    <button class="buy-btn" id="btn-${idx}" onclick="buy(${idx})">üí∞ ${p.c}</button>`;
                list.appendChild(card);
            });
        }

        function buy(idx) {
            let p = marketItems[idx], btn = document.getElementById(`btn-${idx}`), card = document.getElementById(`m-card-${idx}`);
            if(gameData.score >= p.c) {
                gameData.score -= p.c;
                gameData.inventory.push(p.id);
                if(!gameData.unlocked.includes(p.id)) gameData.unlocked.push(p.id);
                btn.innerText = "–ö–£–ü–õ–ï–ù–û!"; btn.classList.add('success');
                setTimeout(() => {
                    if(idx !== 0) { card.classList.add('bought'); setTimeout(() => { marketItems[idx] = null; openMarket(); }, 300); }
                    else { btn.innerText = `üí∞ ${p.c}`; btn.classList.remove('success'); }
                }, 500);
                save();
            } else { btn.innerText = "–ú–ê–õ–û üí∞"; setTimeout(() => btn.innerText = `üí∞ ${p.c}`, 1000); }
        }

        function openAtlas() {
            document.getElementById('atlasOverlay').style.display = 'flex';
            const list = document.getElementById('atlasList'); list.innerHTML = '';
            FLORA.forEach(p => {
                let isOpen = gameData.unlocked.includes(p.id);
                let card = document.createElement('div');
                card.className = `m-card rarity-${p.rar} ${isOpen ? '' : ' locked'}`;
                card.innerHTML = `<div class="icon">${isOpen ? p.i : '‚ùì'}</div>
                    <div class="info">
                        <b>${isOpen ? p.n : '???'}</b><br>
                        <small>${isOpen ? 'üí∞: ' + p.inc + '/—Å | ‚è≥: ' + p.life + '—Å' : '–°–Ω–∞—á–∞–ª–∞ –∫—É–ø–∏—Ç–µ —ç—Ç–æ —Ä–∞—Å—Ç–µ–Ω–∏–µ'}</small>
                    </div>`;
                list.appendChild(card);
            });
        }

        function openBag(slotIdx) {
            document.getElementById('bagOverlay').style.display = 'flex';
            const list = document.getElementById('bagList'); list.innerHTML = '';
            gameData.inventory.forEach((id, invIdx) => {
                let p = FLORA[id], card = document.createElement('div');
                card.className = `m-card rarity-${p.rar}`;
                card.innerHTML = `<div class="icon">${p.i}</div>
                    <div class="info"><b>${p.n}</b></div>
                    <button class="buy-btn" onclick="plant(${invIdx}, ${slotIdx})">–ü–û–°–ê–î–ò–¢–¨</button>`;
                list.appendChild(card);
            });
        }

        function plant(invIdx, slotIdx) {
            let id = gameData.inventory.splice(invIdx, 1)[0];
            gameData.garden[slotIdx] = { id, w: 100, h: 100, age: 0 };
            closeOverlay('bagOverlay'); renderGarden(); save();
        }

        function refreshMarket() {
            marketItems = [FLORA[0]];
            for(let i=1; i<6; i++) marketItems.push(FLORA[Math.floor(Math.random() * FLORA.length)]);
            if(document.getElementById('marketOverlay').style.display === 'flex') openMarket();
        }

        function closeOverlay(id) { document.getElementById(id).style.display = 'none'; }

        function tick() {
            if(!currentUser) return;
            marketTimer--; if(marketTimer <= 0) { marketTimer = 300; refreshMarket(); }
            let m = Math.floor(marketTimer/60), s = marketTimer%60;
            document.getElementById('mTimer').innerText = `–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑: ${m}:${s<10?'0'+s:s}`;
            let night = new Date().getSeconds() >= 30;
            document.getElementById('sky').style.background = night ? 'var(--sky-night)' : 'var(--sky-day)';
            
            gameData.garden.forEach((p, i) => {
                if(p) {
                    let info = FLORA[p.id];
                    p.w = Math.max(0, p.w - (night ? 0.2 : 0.9));
                    p.age += 1; // –í–æ–∑—Ä–∞—Å—Ç –∏–¥–µ—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
                    
                    if(p.w < 20) p.h -= 1.0;
                    
                    // –°–º–µ—Ä—Ç—å –æ—Ç —Å—Ç–∞—Ä–æ—Å—Ç–∏ –∏–ª–∏ –ø–æ—Ç–µ—Ä–∏ –∑–¥–æ—Ä–æ–≤—å—è
                    if(p.age >= info.life || p.h <= 0) {
                        gameData.garden[i] = null;
                        renderGarden();
                    } else if(p.h > 40) {
                        gameData.score += info.inc;
                    }
                }
            });
            document.getElementById('score').innerText = 'üí∞ ' + Math.floor(gameData.score);
            renderGarden(); save();
        }
    </script>
</body>
</html>
