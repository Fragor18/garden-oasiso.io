<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OASIS ‚Äî Mega Flora & Rare Market</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #2e7d32; --accent: #4caf50; 
            --sky-day: #4facfe; --sky-night: #0a0f1e;
            --rarity0: #888; --rarity1: #2ecc71; --rarity2: #3498db; --rarity3: #9b59b6; --rarity4: #f1c40f;
        }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; font-family: 'Ubuntu', sans-serif; background: #000; overflow: hidden; }

        #sky { position: fixed; inset: 0; z-index: -10; transition: 3s; background: var(--sky-day); }

        .site-header { 
            position: fixed; top: 0; width: 100%; height: 60px;
            background: rgba(0,0,0,0.85); display: flex; justify-content: space-between; 
            align-items: center; padding: 0 15px; z-index: 1000; color: white; border-bottom: 2px solid var(--primary);
        }

        .main-nav { position: fixed; top: 60px; width: 100%; display: flex; justify-content: center; gap: 8px; padding: 10px; z-index: 900; }

        .layer { position: absolute; inset: 0; padding-top: 120px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; z-index: 10; }
        .hidden { display: none !important; }

        /* –†–´–ù–û–ö */
        .market-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 95%; max-width: 500px; padding-bottom: 120px; }
        .market-item { background: white; border-radius: 15px; padding: 10px; text-align: center; border-bottom: 4px solid #ddd; }
        .market-item.empty { background: #333; color: #666; border-bottom: none; display: flex; align-items: center; justify-content: center; font-weight: bold; height: 120px; }
        .rarity-tag { font-size: 10px; font-weight: bold; text-transform: uppercase; color: white; padding: 2px 6px; border-radius: 5px; margin-bottom: 5px; display: inline-block; }

        /* –°–ê–î */
        .garden-grid { display: grid; gap: 8px; padding: 10px; grid-template-columns: repeat(2, 1fr); width: 100%; max-width: 500px; padding-bottom: 120px; }
        @media (min-width: 600px) { .garden-grid { grid-template-columns: repeat(4, 1fr); } }

        .garden-slot { aspect-ratio: 1/1.2; background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; color: white; position: relative; }
        .plant-card { width: 100%; height: 100%; background: white; color: #333; border-radius: 13px; padding: 5px; display: flex; flex-direction: column; align-items: center; justify-content: space-between; border-top: 4px solid var(--primary); }

        .bar-wrap { width: 90%; height: 6px; background: #eee; border-radius: 3px; margin: 1px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: 0.3s; }

        .btn { padding: 8px 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; background: var(--primary); color: white; font-size: 0.8rem; }
        .hotbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); padding: 10px 20px; border-radius: 30px; display: flex; gap: 20px; z-index: 1000; border: 1px solid var(--accent); }
        .tool { font-size: 1.5rem; cursor: pointer; opacity: 0.4; }
        .tool.active { opacity: 1; transform: scale(1.2); }

        .modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 3000; }
        .modal { background: white; padding: 20px; border-radius: 20px; width: 90%; max-width: 350px; max-height: 80vh; overflow-y: auto; }
    </style>
</head>
<body>
    <div id="sky"></div>
    <div id="gameUI">
        <header class="site-header">
            <div id="score">üí∞ 150</div>
            <div id="status">‚òÄÔ∏è ‚òÅÔ∏è</div>
            <div id="mTimer" style="font-size: 0.7rem;">–û–ë–ù–û–í–õ–ï–ù–ò–ï: 05:00</div>
        </header>

        <nav class="main-nav">
            <button class="btn" onclick="showPage('homePage')">üè†</button>
            <button class="btn" onclick="showPage('gardenPage')">üåø –°–ê–î</button>
            <button class="btn" onclick="showPage('marketPage')">üõí –†–´–ù–û–ö</button>
        </nav>

        <div id="homePage" class="layer">
            <div style="background:white; padding:20px; border-radius:20px; text-align:center; width:90%; max-width:350px;">
                <h2>–ú–û–ô –ü–†–û–§–ò–õ–¨</h2>
                <div style="font-size:4rem">üë®‚Äçüåæ</div>
                <p>–°–µ–º–µ–Ω–∞ –≤ —Å—É–º–∫–µ: <b id="statSeeds">0</b></p>
                <p>–ö–ª–µ—Ç–æ–∫ –æ—Ç–∫—Ä—ã—Ç–æ: <b id="statSlots">3</b></p>
                <button class="btn" onclick="showPage('gardenPage')">–í –°–ê–î</button>
            </div>
        </div>

        <div id="gardenPage" class="layer hidden">
            <div id="gardenGrid" class="garden-grid"></div>
            <div class="hotbar">
                <div class="tool active" id="t-water" onclick="setTool('water')">üíß</div>
                <div class="tool" id="t-food" onclick="setTool('food')">üß™</div>
                <div class="tool" id="t-trash" onclick="setTool('trash')">üóëÔ∏è</div>
            </div>
        </div>

        <div id="marketPage" class="layer hidden">
            <div id="marketList" class="market-grid"></div>
        </div>
    </div>

    <div id="modalBg" class="modal-bg" onclick="closeM()">
        <div class="modal" id="modalContent" onclick="event.stopPropagation()"></div>
    </div>

    <script>
        const FLORA = [
            { id: 0, n: '–¢—Ä–∞–≤–∞', i: 'üå±', inc: 2, c: 20, r: 0 },
            { id: 1, n: '–†–æ–º–∞—à–∫–∞', i: 'üåº', inc: 5, c: 60, r: 0 },
            { id: 2, n: '–ú—è—Ç–∞', i: 'üåø', inc: 8, c: 100, r: 0 },
            { id: 3, n: '–ö–∞–∫—Ç—É—Å', i: 'üåµ', inc: 15, c: 250, r: 1 },
            { id: 4, n: '–¢—é–ª—å–ø–∞–Ω', i: 'üå∑', inc: 25, c: 500, r: 1 },
            { id: 5, n: '–ü–æ–¥—Å–æ–ª–Ω—É—Ö', i: 'üåª', inc: 40, c: 1000, r: 1 },
            { id: 6, n: '–†–æ–∑–∞', i: 'üåπ', inc: 70, c: 2000, r: 2 },
            { id: 7, n: '–õ–∏–ª–∏—è', i: 'ü™∑', inc: 100, c: 4000, r: 2 },
            { id: 8, n: '–ü–∞–ª—å–º–∞', i: 'üå¥', inc: 150, c: 7500, r: 2 },
            { id: 9, n: '–ë–∞–º–±—É–∫', i: 'üéã', inc: 300, c: 15000, r: 3 },
            { id: 10, n: '–ö–ª–µ–Ω', i: 'üçÅ', inc: 500, c: 30000, r: 3 },
            { id: 11, n: '–ï–ª—å', i: 'üå≤', inc: 800, c: 60000, r: 3 },
            { id: 12, n: '–ú—É—Ö–æ–ª–æ–≤–∫–∞', i: 'ü™¥', inc: 1200, c: 100000, r: 3 },
            { id: 13, n: '–ì—Ä–∏–±', i: 'üçÑ', inc: 2000, c: 200000, r: 3 },
            { id: 14, n: '–í–∏—à–Ω—è', i: 'üçí', inc: 3500, c: 450000, r: 4 },
            { id: 15, n: '–î—Ä–∞–∫–æ–Ω—å–µ –¥–µ—Ä–µ–≤–æ', i: 'üêâ', inc: 6000, c: 900000, r: 4 },
            { id: 16, n: '–ó–æ–ª–æ—Ç–æ–π –ö–ª–µ–≤–µ—Ä', i: 'üçÄ', inc: 10000, c: 2000000, r: 4 },
            { id: 17, n: '–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –º–æ—Ö', i: 'üåå', inc: 25000, c: 5000000, r: 4 },
            { id: 18, n: '–û–≥–Ω–µ–Ω–Ω—ã–π –∫—É—Å—Ç', i: 'üî•', inc: 60000, c: 15000000, r: 4 },
            { id: 19, n: '–ö—Ä–∏—Å—Ç–∞–ª—å–Ω—ã–π –ª–æ—Ç–æ—Å', i: 'üíé', inc: 150000, c: 50000000, r: 4 }
        ];

        const RARITY_NAMES = ['–û–±—ã—á–Ω–æ–µ', '–ù–µ–æ–±—ã—á–Ω–æ–µ', '–†–µ–¥–∫–æ–µ', '–≠–ø–∏—á–µ—Å–∫–æ–µ', '–õ–ï–ì–ï–ù–î–ê'];
        const RARITY_CHANCES = [0.8, 0.5, 0.3, 0.15, 0.05];

        let gameData = { score: 150, slots: 3, garden: new Array(16).fill(null), inventory: [0, 0, 1] };
        let marketItems = [];
        let currentTool = 'water';
        let marketTimer = 300;

        function updateMarket() {
            marketItems = [];
            for(let i=0; i<6; i++) {
                let randomPlant = FLORA[Math.floor(Math.random() * FLORA.length)];
                if(Math.random() < RARITY_CHANCES[randomPlant.r]) {
                    marketItems.push(randomPlant);
                } else {
                    marketItems.push(null);
                }
            }
            renderMarket();
        }

        function renderMarket() {
            const list = document.getElementById('marketList');
            list.innerHTML = marketItems.map((p, idx) => {
                if(!p) return `<div class="market-item empty">–ù–ï–¢ –í –ù–ê–õ–ò–ß–ò–ò</div>`;
                return `
                <div class="market-item">
                    <span class="rarity-tag" style="background:var(--rarity${p.r})">${RARITY_NAMES[p.r]}</span>
                    <div style="font-size:2rem">${p.i}</div>
                    <div style="font-weight:bold; font-size:0.8rem">${p.n}</div>
                    <button class="btn" style="width:100%; margin-top:5px" onclick="buySeed(${p.id}, ${idx})">üí∞ ${p.c}</button>
                </div>`;
            }).join('');
        }

        function buySeed(id, mIdx) {
            const p = FLORA[id];
            if(gameData.score >= p.c) {
                gameData.score -= p.c;
                gameData.inventory.push(id);
                marketItems[mIdx] = null;
                renderMarket();
                save();
            }
        }

        function renderGarden() {
            const g = document.getElementById('gardenGrid');
            g.innerHTML = '';
            for(let i=0; i<16; i++) {
                let p = gameData.garden[i];
                let locked = i >= gameData.slots;
                let slot = document.createElement('div');
                slot.className = 'garden-slot';
                if(locked) {
                    let cost = gameData.slots * 1500;
                    slot.innerHTML = `üîí<br><small>${cost}</small>`;
                    slot.style.background = "rgba(0,0,0,0.4)";
                    slot.onclick = () => { if(gameData.score >= cost) { gameData.score -= cost; gameData.slots++; renderGarden(); } };
                } else if(!p) {
                    slot.innerHTML = '‚ûï';
                    slot.onclick = () => openPlantMenu(i);
                } else {
                    let info = FLORA[p.id];
                    slot.innerHTML = `
                        <div class="plant-card" style="border-top-color:var(--rarity${info.r})">
                            <span style="font-size:8px">${Math.floor(p.age)}/50 –ª.</span>
                            <div style="font-size:2rem">${info.i}</div>
                            <div class="bar-wrap"><div class="bar-fill" style="width:${p.w}%; background:#3b82f6"></div></div>
                            <div class="bar-wrap"><div class="bar-fill" style="width:${p.h}%; background:#22c55e"></div></div>
                        </div>`;
                    slot.onclick = () => {
                        if(currentTool === 'water') p.w = Math.min(p.w + 40, 100);
                        if(currentTool === 'food') p.h = Math.min(p.h + 20, 100);
                        if(currentTool === 'trash') gameData.garden[i] = null;
                        renderGarden();
                    };
                }
                g.appendChild(slot);
            }
            document.getElementById('statSeeds').innerText = gameData.inventory.length;
            document.getElementById('statSlots').innerText = gameData.slots;
        }

        function openPlantMenu(sIdx) {
            if(gameData.inventory.length === 0) return alert("–†—é–∫–∑–∞–∫ –ø—É—Å—Ç!");
            let h = '<h3>–ü–û–°–ê–î–ò–¢–¨</h3>';
            gameData.inventory.forEach((id, iIdx) => {
                let p = FLORA[id];
                h += `<div class="btn" style="display:flex; justify-content:space-between; margin:5px 0; background:white; color:black; border:1px solid #ddd" onclick="plantSeed(${sIdx}, ${iIdx})">
                    <span>${p.i} ${p.n}</span> <span style="color:var(--rarity${p.r})">‚òÖ</span>
                </div>`;
            });
            document.getElementById('modalContent').innerHTML = h;
            document.getElementById('modalBg').style.display = 'flex';
        }

        function plantSeed(sIdx, iIdx) {
            let id = gameData.inventory.splice(iIdx, 1)[0];
            gameData.garden[sIdx] = { id, w: 100, h: 100, age: 0 };
            closeM(); renderGarden();
        }

        function showPage(p) {
            ['homePage', 'gardenPage', 'marketPage'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(p).classList.remove('hidden');
        }

        function setTool(t) {
            currentTool = t;
            document.querySelectorAll('.tool').forEach(el => el.classList.remove('active'));
            document.getElementById('t-'+t).classList.add('active');
        }

        function save() { localStorage.setItem('oasis_final_v1', JSON.stringify(gameData)); }
        function closeM() { document.getElementById('modalBg').style.display = 'none'; }

        setInterval(() => {
            marketTimer--;
            if(marketTimer <= 0) { marketTimer = 300; updateMarket(); }
            
            let sky = document.getElementById('sky');
            let sec = new Date().getSeconds();
            if(sec < 30) { sky.style.background = 'var(--sky-day)'; document.getElementById('status').innerText = '‚òÄÔ∏è ‚òÅÔ∏è'; }
            else { sky.style.background = 'var(--sky-night)'; document.getElementById('status').innerText = 'üåô ‚ú®'; }

            gameData.garden.forEach((p, i) => {
                if(p) {
                    p.w = Math.max(0, p.w - 0.7);
                    p.age += 0.1;
                    if(p.w < 20) p.h -= 0.6;
                    if(p.age >= 50 || p.h <= 0) gameData.garden[i] = null;
                    else if(p.h > 40) gameData.score += FLORA[p.id].inc;
                }
            });

            document.getElementById('score').innerText = 'üí∞ ' + Math.floor(gameData.score);
            let m = Math.floor(marketTimer / 60), s = marketTimer % 60;
            document.getElementById('mTimer').innerText = `–û–ë–ù–û–í–õ–ï–ù–ò–ï: ${m}:${s<10?'0'+s:s}`;
            save();
        }, 1000);

        updateMarket();
        renderGarden();
    </script>
</body>
</html>
